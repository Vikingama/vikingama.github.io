<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='鬼知道为什么这么喜欢给自己挖坑，换一份工作就换一种技术栈呀，摔'><title>Angular 快速上手 · Stay Hungry · Stay Foolish</title>
<link rel=canonical href=https://vikingama.github.io/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/><link rel=stylesheet href=/scss/style.min.38c15d3a5c1bca30008bb625a46636d24f5deb4bf3217095e667a3abc843eaef.css><meta property='og:title' content='Angular 快速上手'><meta property='og:description' content='鬼知道为什么这么喜欢给自己挖坑，换一份工作就换一种技术栈呀，摔'><meta property='og:url' content='https://vikingama.github.io/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/'><meta property='og:site_name' content='馬腊咯稽'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2022-03-16T00:00:00+00:00'><meta property='article:modified_time' content='2022-03-16T00:00:00+00:00'><meta property='og:image' content='https://vikingama.github.io/img/cover/angular.png'><meta name=twitter:title content="Angular 快速上手"><meta name=twitter:description content="鬼知道为什么这么喜欢给自己挖坑，换一份工作就换一种技术栈呀，摔"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://vikingama.github.io/img/cover/angular.png'><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><meta name=theme-color content="#ffffff"><meta name=robots content="noarchive"><div class=warning-banner>因为 GitHub 账号二次验证失败，计划迁往
<a href=https://elementref.github.io/>新地址&rarr;</a></div></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huae06eac29c2bc6aa7e83a685ea2f6536_13838_300x0_resize_box_3.png width=300 height=404 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>馬腊咯稽</a></h1><h2 class=site-description>Stay Hungry · Stay Foolish</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=https://github.com/ElementRef/AboutConfig target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg>
<span>配置</span></a></li><li><a href=/%E5%90%AF%E5%8F%91/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>启发</span></a></li><li><a href=/%E5%91%BD%E4%BB%A4/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 7l5 5-5 5"/><line x1="12" y1="19" x2="19" y2="19"/></svg>
<span>命令</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>深色</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/><img src=/img/cover/angular.png loading=lazy alt="Angular 快速上手"></a></div><div class=article-details><header class=article-category><a href=/categories/angular/>Angular</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/>Angular 快速上手</a></h2><h3 class=article-subtitle>鬼知道为什么这么喜欢给自己挖坑，换一份工作就换一种技术栈呀，摔</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 16, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长：39 分钟</time></div></footer></div></header><section class=article-content><h2 id=组件>组件</h2><p>在 Angular 中，组件是用来定义视图的，一个应用至少有一个根组件（属于根模块的一部分）；组件由三部分组成：组件类（控制组件模板渲染）、组件模板、组件样式（默认仅对当前组件生效，不会污染全局）；可以使用 ng generate 命令或<a class=link href="https://marketplace.visualstudio.com/items?itemName=alexiv.vscode-angular2-files" target=_blank rel=noopener>
编辑器扩展
</a>快速新建组件（服务、管道&mldr;）：</p><ol><li>组件模板，语法和 HTML 几乎相同，多了一些 Angular 独有的指令和标签；</li><li>组件样式，作用域仅限于当前组件（可以通过“样式封装策略 encapsulation”进行更改）；</li><li>组件类，就是普通的 class；组件类中声明的属性和方法会自动注入组件模板中。</li></ol><p>组件的父子关系是通过“组件的视图对象”间接建立的；每个组件都有一个宿主视图和一些内建视图。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>slideMotion</span> <span class=o>=</span> <span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;slideMotion&#39;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 创建一组有名字的 CSS 样式，它会在成功转换到指定的状态时应用到元素上
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>state</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;void&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义一个或多个要用于动画中的 CSS 样式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>style</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>opacity</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>transform</span><span class=o>:</span> <span class=s1>&#39;scaleY(0.8)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;enter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>style</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>opacity</span>: <span class=kt>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>transform</span><span class=o>:</span> <span class=s1>&#39;scaleY(1)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 定义两个命名状态之间的动画序列
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>transition</span><span class=p>(</span><span class=s1>&#39;void =&gt; *&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>animate</span><span class=p>(</span><span class=s1>&#39;0.2s cubic-bezier(0.7, 0.3, 0.1, 1)&#39;</span><span class=p>)]),</span>
</span></span><span class=line><span class=cl>  <span class=nx>transition</span><span class=p>(</span><span class=s1>&#39;* =&gt; void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>animate</span><span class=p>(</span><span class=s1>&#39;0.2s cubic-bezier(0.86, 0, 0.07, 1)&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// 组件类需要由 @Component 装饰器进行修饰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 动画相关元数据，用来放置“定义动画的触发器”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>animations</span><span class=o>:</span> <span class=p>[</span><span class=nx>slideMotion</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 变更检测策略：
</span></span></span><span class=line><span class=cl><span class=cm>   *  1. ChangeDetectionStrategy.Default：异步逻辑结束（事件、请求等等），NgZone 会自上而下对整个组件树做变更检测
</span></span></span><span class=line><span class=cl><span class=cm>   *  2. ChangeDetectionStrategy.OnPush：用来跳过某些变更检测（因为不是每个操作都需要进行变更检测）
</span></span></span><span class=line><span class=cl><span class=cm>   * 在 OnPush 策略下，有四种情况仍旧可以触发变更检测：
</span></span></span><span class=line><span class=cl><span class=cm>   *  1. 组件 @Input 引用变化（这种情况下，搭配 Immutable.js 使用更佳）
</span></span></span><span class=line><span class=cl><span class=cm>   *  2. 组件及其子组件的 DOM 事件触发（计时器、异步请求、Promise 均不会触发检测）
</span></span></span><span class=line><span class=cl><span class=cm>   *  3. 组件内 Observable 订阅事件，同时设置 AsyncPipe
</span></span></span><span class=line><span class=cl><span class=cm>   *  4. 手动调用：
</span></span></span><span class=line><span class=cl><span class=cm>   *       ChangeDetectorRef.detectChanges()，立即触发组件的变更检测
</span></span></span><span class=line><span class=cl><span class=cm>   *       ChangeDetectorRef.markForCheck()，等待应用的下一轮变更检测
</span></span></span><span class=line><span class=cl><span class=cm>   *       ApplicationRef.tick()，触发整个应用的变更检测
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>changeDetection</span>: <span class=kt>ChangeDetectionStrategy.Default</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 样式封装策略：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. ViewEncapsulation.ShadowDom，样式仅添加到 ShadowDOM 宿主中，基于 ShadowDOM 实现组件样式的封装与隔离；
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. ViewEncapsulation.Emulated，默认策略，样式会被添加到 &lt;head&gt; 中，基于 CSS 属性选择器来实现组件样式的封装与隔离；
</span></span></span><span class=line><span class=cl><span class=cm>   * 3. ViewEncapsulation.None，样式会被添加到 &lt;head&gt; 中，不对样式进行封装与隔离，样式作用于全局（document）。
</span></span></span><span class=line><span class=cl><span class=cm>   * ViewEncapsulation.ShadowDom 不是默认策略的原因是“并不是每个浏览器都支持 ShadowDOM”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>encapsulation</span>: <span class=kt>ViewEncapsulation.Emulated</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 放置一些『被动态调用』的组件，这些组件没有“直接”在模板中使用，Ng 是不知道是否应该对这些组件进行编译的
</span></span></span><span class=line><span class=cl><span class=cm>   * entryComponents 引入的组件会通过 ViewContainerRef.createComponent 方法被动态调用
</span></span></span><span class=line><span class=cl><span class=cm>   * 编译器会将这些组件编译并为他们创建“工厂函数”
</span></span></span><span class=line><span class=cl><span class=cm>   * 比如，一些在 Modal 中展示的组件
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>entryComponents</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 改写默认的插值表达式起止分界符，在和第三方库冲突的时候才会修改
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>interpolation</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 仅在 CommonJS 规范下有意义，用于解析组件模板和样式
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>moduleId</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 是否从编译后的模板中移除多余的空白字符
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>preserveWhitespaces</span>: <span class=kt>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 组件“在模版中”只能以 &lt;app-example&gt;&lt;/app-example&gt; 的方式进行调用
</span></span></span><span class=line><span class=cl><span class=cm>   * selector 决定了组件在模版中的调用方式
</span></span></span><span class=line><span class=cl><span class=cm>   * 当 Angular 在模版中找到相应的标签时
</span></span></span><span class=line><span class=cl><span class=cm>   * 就把该组件实例化在那里
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-example&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件“在模版中”只能以 &lt;xxx [app-example]&gt;&lt;/xxx&gt; 的方式进行调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;[app-example]&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 内部样式字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>styles</span><span class=o>:</span> <span class=s1>&#39;div{...} div&gt;p{...}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 外部样式路径
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>styleUrls</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;./app.component.scss&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 内部模板字符串
</span></span></span><span class=line><span class=cl><span class=cm>   * template 和 templateUrl 不能同时存在
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;div&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 外部模板路径
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>templateUrl</span><span class=o>:</span> <span class=s1>&#39;./app.component.html&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// viewProviders 注册的 provider 只对 viewChildren 可见，对 contentChildren 不可见
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>viewProviders</span><span class=o>:</span> <span class=p>[</span><span class=nx>BbService</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * providers 注册的 provider 对 contentChildren 和 viewChildren 均可见
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果你愿意的话，可以总是使用 providers 而忽略 viewProviders
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[</span><span class=nx>AaService</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ExampleComponent</span>
</span></span><span class=line><span class=cl>  <span class=kr>implements</span>
</span></span><span class=line><span class=cl>    <span class=nx>OnChanges</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>DoCheck</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>OnDestroy</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>OnInit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>AfterContentInit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>AfterContentChecked</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>AfterViewInit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>AfterViewChecked</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 使用 @Input 修饰组件要从外部接受的属性
</span></span></span><span class=line><span class=cl><span class=cm>   * &lt;app-example [propOne]=&#34;someValue&#34;&gt;&lt;/app-example&gt;
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>propOne</span> <span class=o>=</span> <span class=s1>&#39;defaultPropOneValue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 可以给 propTwo 起一个别名（风格指南并不推荐）
</span></span></span><span class=line><span class=cl><span class=cm>   * &lt;app-example [prop-two]=&#34;someValue&#34;&gt;&lt;/app-example&gt;
</span></span></span><span class=line><span class=cl><span class=cm>   * 在组件内部，仍可以用 this.propTwo 访问接受到的属性值
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>(</span><span class=s1>&#39;prop-two&#39;</span><span class=p>)</span> <span class=nx>propTwo</span> <span class=o>=</span> <span class=s1>&#39;defaultPropTwoValue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 可以把 propThree 写成 getter/setter
</span></span></span><span class=line><span class=cl><span class=cm>   * 来“监听”外部的值的变化
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>(</span><span class=s1>&#39;prop-three&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>get</span> <span class=nx>propThree() {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>set</span> <span class=nx>propThree</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 可以执行一些别的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>temp</span> <span class=o>=</span> <span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 使用 @Output 修饰组件上绑定的自定义事件
</span></span></span><span class=line><span class=cl><span class=cm>   * 通过 this.updatePropOne.emit(newValue) 向外传值（$event 会接收到 newValue）
</span></span></span><span class=line><span class=cl><span class=cm>   * &lt;app-example (updatePropOneAlias)=&#34;handleXXX($event)&#34;&gt;&lt;/app-example&gt;
</span></span></span><span class=line><span class=cl><span class=cm>   * EventEmitter 继承了 RxJS 中的 Subject
</span></span></span><span class=line><span class=cl><span class=cm>   * export declare interface EventEmitter&lt;T&gt; extends Subject&lt;T&gt; {...}
</span></span></span><span class=line><span class=cl><span class=cm>   * 在“Service”中不能使用 EventEmitter，可以使用 Subject 代替
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>(</span><span class=s1>&#39;updatePropOneAlias&#39;</span><span class=p>)</span> <span class=nx>updatePropOne</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Angular 不会接管构造函数
</span></span></span><span class=line><span class=cl><span class=cm>   * 在构建组件树的时候会被调用
</span></span></span><span class=line><span class=cl><span class=cm>   * 此时，还不能访问组件 DOM（ngOnInit 可以访问 DOM）
</span></span></span><span class=line><span class=cl><span class=cm>   * 组件初始化需要在生命周期函数中进行
</span></span></span><span class=line><span class=cl><span class=cm>   * 这里仅仅用来注入一些组件需要依赖的服务
</span></span></span><span class=line><span class=cl><span class=cm>   * 『依赖注入』机制会分析构造函数的『形参』
</span></span></span><span class=line><span class=cl><span class=cm>   * 调用时，已经处理好根/父级 injectors 了
</span></span></span><span class=line><span class=cl><span class=cm>   * 在 class 实例化的过程中，会向上查找 providers
</span></span></span><span class=line><span class=cl><span class=cm>   * 并将查找的结果传递回构造函数，在构造完成之后才会设置指令的数据绑定输入属性
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * constructor 是在 injector 上下文中调用的唯一方法
</span></span></span><span class=line><span class=cl><span class=cm>     * Angular 的 DI 系统会自动帮我们实例化注入的 Service
</span></span></span><span class=line><span class=cl><span class=cm>     * 并将服务实例绑定到当前实例上（也就是 this）
</span></span></span><span class=line><span class=cl><span class=cm>     * 方便我们以 this.xxService 的方式调用
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>aaService</span>: <span class=kt>AaService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>bbService</span>: <span class=kt>BbService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>ccService</span>: <span class=kt>CcService</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Angular 的运行机制分为两部分：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. 构建组件树；（调用 contructor）
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. 执行脏检查。（调用生命周期函数）
</span></span></span><span class=line><span class=cl><span class=cm>   * 生命周期钩子（属于变更检测的一部分，起始于组件实例化，结束于组件实例的销毁）的执行顺序：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. ngOnChanges（可能执行多次，需注意逻辑精简，仅在有 @Input 属性的情况下才执行）
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. ngOnInit
</span></span></span><span class=line><span class=cl><span class=cm>   * 3. ngDoCheck（可能执行多次，需注意逻辑精简）
</span></span></span><span class=line><span class=cl><span class=cm>   * 4. ngAfterContentInit
</span></span></span><span class=line><span class=cl><span class=cm>   * 5. ngAfterContentChecked（可能执行多次，需注意逻辑精简）
</span></span></span><span class=line><span class=cl><span class=cm>   * 6. ngAfterViewInit（仅存在组件，不能用于指令）
</span></span></span><span class=line><span class=cl><span class=cm>   * 7. ngAfterViewChecked（可能执行多次，需注意逻辑精简；仅存在组件，不能用于指令）
</span></span></span><span class=line><span class=cl><span class=cm>   * 8. ngOnDestroy
</span></span></span><span class=line><span class=cl><span class=cm>   * Compiler 会检查组件的钩子函数，给组件赋予不同的 NodeFlags
</span></span></span><span class=line><span class=cl><span class=cm>   * 在“脏检查”阶段，Angular 会根据组件的 NodeFlags 来调用对应的“钩子”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnChanges</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// changes 仅包含了每个『发生变化』的属性
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>changes</span>: <span class=kt>SimpleChanges</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 1. 如果组件绑定过输入属性，所绑定的一个或多个输入属性的值发生变化时都会调用
</span></span></span><span class=line><span class=cl><span class=cm>     * 2. 如果绑定的是一个对象，如果对象的引用没变，ngOnChanges 就不会执行
</span></span></span><span class=line><span class=cl><span class=cm>     * 3. 如果你的组件『没有输入属性』，框架就『不会调用该方法』
</span></span></span><span class=line><span class=cl><span class=cm>     * 4. 在 ngOnInit 之前调用
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>propName</span> <span class=k>in</span> <span class=nx>changes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>currentValue</span><span class=p>,</span> <span class=nx>previousValue</span><span class=p>,</span> <span class=nx>firstChange</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>changes</span><span class=p>[</span><span class=nx>propName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sb>`current: </span><span class=si>${</span><span class=nx>currentValue</span><span class=si>}</span><span class=sb>, previous: </span><span class=si>${</span><span class=nx>previousValue</span><span class=si>}</span><span class=sb>, isFirstChange: </span><span class=si>${</span><span class=nx>firstChange</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=s1>&#39;propThree&#39;</span> <span class=k>in</span> <span class=nx>changes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 除了 getter/setter，也可以酱紫“监听”变化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 在 ngOnChanges 第一次完成调用之后执行（即使没有绑定任何输入属性）
</span></span></span><span class=line><span class=cl><span class=cm>     * 用来执行复杂的在构造函数之外的组件初始化逻辑
</span></span></span><span class=line><span class=cl><span class=cm>     * 获取初始数据的好地方
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 每当路由的查询参数变化，都重新获取数据
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>fetchData</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngDoCheck</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 用于检测 Angular 无法捕获的变更
</span></span></span><span class=line><span class=cl><span class=cm>     * 紧跟在每次执行变更检测时的 ngOnChanges 和首次执行变更检测时的 ngOnInit 后调用
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterContentInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 当 Angular 把外部内容投影进组件视图或指令所在的视图之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngDoCheck 首次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * 仅仅调用一次
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterContentChecked</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 每当 Angular 把外部内容投影进组件视图或指令所在的视图之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngAfterContentInit 每次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngDoCheck 每次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterViewInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 当 Angular 初始化完组件视图及其子视图或包含该指令的视图之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngAfterContentChecked 首次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * 仅仅调用一次
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterViewChecked</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 每当 Angular 做完组件视图和子视图或包含该指令的视图的变更检测之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngAfterContentChecked 每次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     * ngAfterViewInit 每次调用之后调用
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnDestroy</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 每当指令/组件销毁之前立即调用，用于释放不会被垃圾回收的资源：
</span></span></span><span class=line><span class=cl><span class=cm>     * 1. 反注册在应用服务中注册的回调
</span></span></span><span class=line><span class=cl><span class=cm>     * 2. 取消订阅可观察对象
</span></span></span><span class=line><span class=cl><span class=cm>     * 3. 移除事件绑定
</span></span></span><span class=line><span class=cl><span class=cm>     * 4. 清除计时器
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=指令没有模版的特殊组件>指令（没有“模版”的特殊组件）</h2><p>指令用来将自定义行为附加到 DOM 中：</p><ol><li>结构性指令：通过添加、移除、替换 DOM 来修改布局，例如：*ngIf、*ngFor、*ngSwitch、*ngSwitchDefault、*ngComponentOutlet、*ngTemplateOutlet；</li><li>属性型指令：改变已有元素的外观或行为，例如：ngClass、ngStyle、ngModel、ngNonBindable、ngPreserveWhitespaces；</li><li>Angular 没有提供 AngularJS 中的 ng-show 指令。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Directive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * &lt;div [app-example] #exampleRef=&#34;example&#34;&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=cm>   * 可以通过 exampleRef 获取到“当前指令的引用”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>exportAs</span><span class=o>:</span> <span class=s1>&#39;example&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 将类的属性映射到宿主元素的绑定
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>host</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 当宿主元素（绑定的元素）上的 click 事件被触发时
</span></span></span><span class=line><span class=cl><span class=cm>     * 调用当前指令内的 onClick 方法
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;(click)&#39;</span><span class=o>:</span> <span class=s1>&#39;onClick()&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 宿主元素的 class 被设置为 class-name-example（this.innerClass 的值）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;[class]&#39;</span><span class=o>:</span> <span class=s1>&#39;innerClass&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 可以替代 @Input 装饰器
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>inputs</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 可以替代 @Output 装饰器
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>outputs</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 指令代码会被 AOT（ahead-of-time）编译器忽略
</span></span></span><span class=line><span class=cl><span class=cm>   * 也就是说相关代码不会被预编译（打包的时候编译）
</span></span></span><span class=line><span class=cl><span class=cm>   * 而是保留到运行时进行动态编译
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>jit</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 依赖注入，详见“组件”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 用来标记在哪些元素/组件上使用指令
</span></span></span><span class=line><span class=cl><span class=cm>   * &lt;div [app-example]&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;[app-example]&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ExampleDirective</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 也可以通过 @HostBinding 向宿主元素“绑定属性”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@HostBinding</span><span class=p>(</span><span class=s1>&#39;class&#39;</span><span class=p>)</span> <span class=kr>class</span> <span class=o>=</span> <span class=s1>&#39;class-name&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 也可以通过 @HostListener 向宿主元素“绑定事件”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@HostListener</span><span class=p>(</span><span class=s1>&#39;input&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;$event&#39;</span><span class=p>])</span> <span class=nx>onInput</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=nx>el</span>: <span class=kt>ElementRef</span><span class=p>,</span> <span class=nx>render2</span>: <span class=kt>Renderer2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 通过 ElementRef 可以拿到“宿主元素”的引用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>el</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>backgroundColor</span> <span class=o>=</span> <span class=s1>&#39;red&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>innerClass</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;class-name-example&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>onClick() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;宿主元素上触发了 click 事件&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 借助于 Renderer2 可以修改 Angular 的默认渲染行为
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>render2</span><span class=p>.</span><span class=nx>setStyle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>el</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>,</span> <span class=s1>&#39;color&#39;</span><span class=p>,</span> <span class=s1>&#39;red&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>结构型指令的实现需要借助辅助类 TemplateRef 和 ViewContainerRef：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 一个“延迟渲染”的例子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Directive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;[delayRender]&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>DelayRender</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>viewContainerRef</span>: <span class=kt>ViewContainerRef</span><span class=p>,</span> <span class=c1>// 对容器 View 的引用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>private</span> <span class=nx>templateRef</span>: <span class=kt>TemplateRef</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;</span> <span class=c1>// 对 ng-template 的引用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kr>set</span> <span class=nx>delayRender</span><span class=p>(</span><span class=nx>timer</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>viewContainerRef</span><span class=p>.</span><span class=nx>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>viewContainerRef</span><span class=p>.</span><span class=nx>createEmbeddedView</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>templateRef</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=管道>管道</h2><p>Angular 内置了 async（从 Promise/Observable 中取值）、date、currency、json（JSON2String）、uppercase、lowercase、titlecase、precent 等管道。</p><p>无论是用法还是效果都和 Vue 3.0 中已经删除的 filter 很像，用于数据转换。</p><p>有一点需要注意：管道操作符的优先级<strong>高于</strong>逻辑运算符。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>type</span> <span class=nx>DomSanitizerType</span> <span class=o>=</span> <span class=s1>&#39;html&#39;</span> <span class=o>|</span> <span class=s1>&#39;style&#39;</span> <span class=o>|</span> <span class=s1>&#39;js&#39;</span> <span class=o>|</span> <span class=s1>&#39;url&#39;</span> <span class=o>|</span> <span class=s1>&#39;resourceUrl&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>NzSafeAny</span> <span class=o>=</span> <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Pipe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;sanitizer&#39;</span><span class=p>,</span> <span class=c1>// 管道名称
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 是否为“纯”管道：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. “纯”管道只有在原始数据/对象的&#34;引用变更&#34;时才会执行；
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. “纯”管道会&#34;忽略引用类型内部属性&#34;的变化（引用没变）；
</span></span></span><span class=line><span class=cl><span class=cm>   * 3. “纯”管道内部的的 transform 方法必须为“纯”函数；
</span></span></span><span class=line><span class=cl><span class=cm>   * 4. “非纯”管道性能较差（任何交互行为都会触发执行）。
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>pure</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>SanitizerPipe</span> <span class=kr>implements</span> <span class=nx>PipeTransform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 实现一个“管道”，需要 implements PipeTransform 并实现 transform 方法
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>protected</span> <span class=nx>sanitizer</span>: <span class=kt>DomSanitizer</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;html&#39;</span><span class=p>)</span><span class=o>:</span> <span class=nx>SafeHtml</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;style&#39;</span><span class=p>)</span><span class=o>:</span> <span class=nx>SafeStyle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;js&#39;</span><span class=p>)</span><span class=o>:</span> <span class=nx>SafeScript</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;url&#39;</span><span class=p>)</span><span class=o>:</span> <span class=nx>SafeUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;resourceUrl&#39;</span><span class=p>)</span><span class=o>:</span> <span class=nx>SafeResourceUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>value</span>: <span class=kt>NzSafeAny</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span><span class=o>:</span> <span class=nx>DomSanitizerType</span> <span class=o>=</span> <span class=s1>&#39;html&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span><span class=o>:</span> <span class=nx>SafeHtml</span> <span class=o>|</span> <span class=nx>SafeStyle</span> <span class=o>|</span> <span class=nx>SafeScript</span> <span class=o>|</span> <span class=nx>SafeUrl</span> <span class=o>|</span> <span class=nx>SafeResourceUrl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=kr>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;html&#39;</span><span class=o>:</span> <span class=c1>// 绕过安全检查，并信任给定的值是一个安全的 HTML
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustHtml</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;style&#39;</span><span class=o>:</span> <span class=c1>// 绕过安全检查，并信任给定的值是一个安全的 CSS
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustStyle</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;js&#39;</span><span class=o>:</span> <span class=c1>// 绕过安全检查，并信任给定的值是一个安全的 JS
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustScript</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;url&#39;</span><span class=o>:</span> <span class=c1>// 绕过安全检查，并信任给定的值是一个安全的样式 URL（可以安全的用在 &lt;img src&gt; 中）
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustUrl</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;resourceUrl&#39;</span><span class=o>:</span> <span class=c1>// 绕过安全检查，并信任给定的值是一个安全的资源 URL（可以安全的用在 &lt;script src&gt;、&lt;iframe src&gt; 中）
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustResourceUrl</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`指定的安全类型无效`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>通常我们会在 ngOnInit 中的进行数据请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>class</span> <span class=nx>TicketListComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span>: <span class=kt>srting</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>route</span>: <span class=kt>ActivatedRoute</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>apiService</span>: <span class=kt>ApiService</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchTickets1</span><span class=p>().</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>list</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>data</span> <span class=o>=</span> <span class=nx>list</span> <span class=o>||</span> <span class=p>[]));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 或者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>fetchTickets2</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>list</span> <span class=o>=&gt;</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>data</span> <span class=o>=</span> <span class=nx>list</span> <span class=o>||</span> <span class=p>[]));</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>AsyncPipe 可以替代 ngOnInit 完成这部分逻辑：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Seller</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>srting</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Ticket</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;span&gt;{{ (firstSeller$ | async).name }}&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    // 借助 as 将其重命名为 list
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;ul *ngIf=&#34;tickets$ | async as list&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;li *ngFor=&#34;let item of list&#34;&gt;{{ item.title | emptyValue }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SellerComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 借助 pipe + map 对数据进行处理
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>readonly</span> <span class=nx>firstSeller$</span>: <span class=kt>Seller</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchSellers</span><span class=p>().</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(</span><span class=nx>list</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>list</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 借助 switchMap 切换数据流
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>readonly</span> <span class=nx>tickets$</span>: <span class=kt>Ticket</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>switchMap</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchTickets</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>route</span>: <span class=kt>ActivatedRoute</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>apiService</span>: <span class=kt>ApiService</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不喜欢模版中出现太多 async，可以借助 combineLatest 将多个 Observable 合并：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;ng-container *ngIf=&#34;vm$ | async as vm&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;li *ngFor=&#34;let item of vm.boys&#34;&gt;{{ item.name }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;li *ngFor=&#34;let item of vm.girls&#34;&gt;{{ item.name }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;li *ngFor=&#34;let item of vm.dogs&#34;&gt;{{ item.nickName }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;li *ngFor=&#34;let item of vm.cats&#34;&gt;{{ item.nickName }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/ul&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/ng-container&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>BuyerComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=nx>vm$</span> <span class=o>=</span> <span class=nx>combineLatest</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>switchMap</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchBoys</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>switchMap</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchGirls</span><span class=p>(</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchDogs</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span><span class=p>.</span><span class=nx>fetchCats</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>]).</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(([</span><span class=nx>boys</span> <span class=o>=</span> <span class=p>[],</span> <span class=nx>girls</span> <span class=o>=</span> <span class=p>[],</span> <span class=nx>dogs</span> <span class=o>=</span> <span class=p>[],</span> <span class=nx>cats</span> <span class=o>=</span> <span class=p>[]])</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>boys</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>girls</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dogs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cats</span>
</span></span><span class=line><span class=cl>    <span class=p>}))</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>route</span>: <span class=kt>ActivatedRoute</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>apiService</span>: <span class=kt>ApiService</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>自从 Angular 的编译和渲染引擎切换到 Ivy 之后：</p><ol><li>ChangeDetectionStrategy.Default 策略下，在每次“变更检测”的过程中，“纯”管道的 transform 方法，只有在入参发生变化的情况下才会被调用；</li><li>ChangeDetectionStrategy.Default 策略下，在每次“变更检测”的过程中，“非纯”管道的 transform 方法都会被调用；</li><li>当使用 async 管道时（它是“非纯”的），最好使用 ChangeDetectionStrategy.OnPush 策略；</li><li>无论是否是“纯”管道，每个管道都会有自己的实例（ViewEngine 时期，“纯”管道是共享实例的）；</li><li>在同一模版中，使用了两次 A 管道，则会有两个 A 管道的实例存在。</li></ol><h2 id=服务>服务</h2><p>服务是 Angular 的核心，他是专门用来处理某件事情的（数据请求、数据共享等）具有明确定义的 class；一般情况下，服务用来创建与视图无关但需要跨组件共享的数据/逻辑。</p><p>官方推崇“Component 处理页面展示，Service 处理内在逻辑”的原则（有点像 React 中的 UI 组件和逻辑组件）。</p><p>服务一般（具体看 providedIn 的取值）以单例的形式存在，实例化之后，应用于整个应用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * providedIn 有四种取值：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. platform：平台级别注入，所有应用共享一个服务单例（仅适用于在一个 window 下运行多个 Angular 应用，有点微前端的意思）；
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. root：应用程序（AppModule）/系统/全局/根级别注入，服务可以在整个应用中使用，而且共享同一个服务实例；
</span></span></span><span class=line><span class=cl><span class=cm>   * 3. [NgModule]：仅注入指定的 NgModule 中，仅可在指定的 NgModule 中使用，有 TreeShaking 加成；
</span></span></span><span class=line><span class=cl><span class=cm>   * 4. any：在每个注入的模块中，提供一个唯一的实例；
</span></span></span><span class=line><span class=cl><span class=cm>   * 5. null：仅仅表明可注入。
</span></span></span><span class=line><span class=cl><span class=cm>   * 这种方式要优于 @NgModule({providers: [xxx]})，因为可以被 Tree Shaking
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>providedIn</span><span class=o>:</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ApiPublicService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 服务也可依赖别的服务，这里就依赖了 HttpClient
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>http</span>: <span class=kt>HttpClient</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>paginationData</span><span class=p>(</span><span class=nx>data</span>: <span class=kt>any</span><span class=p>)</span><span class=o>:</span> <span class=nx>PaginationData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>total</span>: <span class=kt>data.total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>pageSize</span>: <span class=kt>data.size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>pageIndex</span>: <span class=kt>data.current</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>buildResponse</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>temp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>success</span>: <span class=kt>response.success</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span>: <span class=kt>response.status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span>: <span class=kt>response.data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>raw</span>: <span class=kt>response</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>records</span>: <span class=kt>response?.data?.records</span> <span class=o>||</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>      <span class=nx>objects</span>: <span class=kt>response?.data</span> <span class=o>||</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>errorCode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>temp</span><span class=p>.</span><span class=nx>errorCode</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>errorCode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>errorMessage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>temp</span><span class=p>.</span><span class=nx>errorMessage</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>errorMessage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>toResponse() {</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>map</span><span class=p>(</span><span class=nx>response</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>buildResponse</span><span class=p>(</span><span class=nx>response</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>      <span class=nx>tap</span><span class=p>(</span><span class=nx>response</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>errorCode</span> <span class=o>===</span> <span class=s1>&#39;LOGIN_INVALID&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>fetchList</span><span class=p>(</span><span class=nx>params</span>: <span class=kt>ApiParams</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>http</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>environment</span><span class=p>.</span><span class=nx>apiHost</span><span class=si>}</span><span class=sb>/api/v1/list`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>toResponse</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>map</span><span class=p>(</span><span class=nx>response</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>paginationData</span>: <span class=kt>this.paginationData</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=nx>records</span>: <span class=kt>response.data.records</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>pages</span>: <span class=kt>response.data.pages</span>
</span></span><span class=line><span class=cl>        <span class=p>}))</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=模块>模块</h2><p>NgModule 是 Angular 的基本构造块（NgModule 和 ESModule 不同但互补），也是 Angular 对“依赖”进行组织的一种形式；其为组件提供了编译上下文；一个 Angular 应用由至少一个根模块（AppModule）和多个特性模块组成。</p><p>NgModule 可以将组件及其相关代码（服务等）关联，形成功能单元（一般是按照业务划分的）；模块之间即相互独立又可通过 imports/exports 建立联系；模块可以让代码更“内聚”。</p><p>一个 Angular 应用一般包含四种模块：</p><ul><li>根模块（引导模块），一个应用仅有一个根模块；</li><li>核心模块，为应用提供基础能力的模块，比如：路由模块、数据请求模块；</li><li>公共模块，包含了：公共组件、公共管道、公共指令；</li><li>业务模块，封装了具体业务的模块。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@NgModule</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 使用：platformBrowserDynamic().bootstrapModule(AppModule) 启动根模块
</span></span></span><span class=line><span class=cl><span class=cm>   * 只有根模块（一个应用只有一个）才设置这个属性
</span></span></span><span class=line><span class=cl><span class=cm>   * 表示该模块应用的主视图（一般是根组件）
</span></span></span><span class=line><span class=cl><span class=cm>   * 同时也表明这个模块是“根模块”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>bootstrap</span><span class=o>:</span> <span class=p>[</span><span class=nx>AppComponent</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 声明该模块（包含/定义）的组件、管道、指令
</span></span></span><span class=line><span class=cl><span class=cm>   * 这些组件、管道、指令是当前模块“私有的”（如果没有放入 exports）
</span></span></span><span class=line><span class=cl><span class=cm>   * 一个组件/指令/管道只能属于一个模块，不能同时把一个类声明在几个模块中
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>declarations</span><span class=o>:</span> <span class=p>[</span><span class=nx>ExampleComponent</span><span class=p>,</span> <span class=nx>ExamplePipe</span><span class=p>,</span> <span class=nx>ExampleDirective</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果组件没有直接在模版中使用，AOT 就不会提前编译组件
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果将组件添加到 entryComponents
</span></span></span><span class=line><span class=cl><span class=cm>   * AOT 就会提前编译组件
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>entryComponents</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 当前 NgModule 在 getNgModuleById 中的名字或唯一标识符
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果为 undefined，则该模块不会被注册到 getNgModuleById 中
</span></span></span><span class=line><span class=cl><span class=cm>   * 用到的不多，官网也没做过多介绍，Angular 会自动帮我们处理
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>undefined</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 导入（当前模块运行需要依赖的的）其他模块：
</span></span></span><span class=line><span class=cl><span class=cm>   * 1. 被导入模块的 exports（低优先级）会和当前模块的 declarations（高优先级）合并
</span></span></span><span class=line><span class=cl><span class=cm>   * 2. 被导入模块的 providers 会和当前模块的 providers 合并
</span></span></span><span class=line><span class=cl><span class=cm>   * 3. 被导入模块的路由会和当前模块的路由合并
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>[</span><span class=nx>BrowserModule</span><span class=p>,</span> <span class=nx>OneModule</span><span class=p>,</span> <span class=nx>TwoModule</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 暴露（可供其他模块使用的）当前模块中的一些组件、指令和管道
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>exports</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 编译器选项，详见“指令”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>jit</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 当前模块需要的提供者（可注入对象，例如：ApiService）
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果 provider 在根模块注入，则注入的 provider 为单例模式
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 当前 NgModule 中允许使用的声明元素的 HTML 架构
</span></span></span><span class=line><span class=cl><span class=cm>   * 当遇到不认识的元素时，怎么做处理
</span></span></span><span class=line><span class=cl><span class=cm>   * 用于测试代码，业务中用不上
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>schemas</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ExampleModule</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=表单>表单</h2><p>Angular 提供了两种不同的方法来通过表单处理用户输入：响应式表单和模板驱动表单。两者都从视图中捕获用户输入事件、验证用户输入、创建表单模型、修改数据模型，并提供跟踪这些更改的途径：</p><ul><li>响应式表单：提供对底层表单对象模型直接、显式的访问；可伸缩性、可扩展性、可复用性和可测试性都更高；视图和数据模型之间使用同步数据流；</li><li>模版驱动表单：依赖模板中的指令来创建和操作底层的对象模型，在扩展性方面不如响应式表单，专注于简单场景，视图和数据模型之间使用异步数据流。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 使用“响应式表单”，需要在 NgModule 中导入 ReactiveFormsModule 和 FormsModule：
</span></span></span><span class=line><span class=cl><span class=cm> * ReactiveFormsModule：提供 formControl、ngFormGroup 等指令；
</span></span></span><span class=line><span class=cl><span class=cm> * FormsModule：提供 ngForm、ngModel 等模版驱动指令。
</span></span></span><span class=line><span class=cl><span class=cm> * ngForm 的 selector 包含了 form:not([formGroup]) ；
</span></span></span><span class=line><span class=cl><span class=cm> * 所以，一般不用显式添加 ngForm 指令。
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>FormBuilder</span><span class=p>,</span> <span class=c1>// 提供一种更方便使用 FormGroup、FormArray 和 FormControl 的方式
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>FormControl</span><span class=p>,</span> <span class=c1>// 保存了字段的值和状态（是否合法、是否修改、是否禁用等）
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>FormGroup</span><span class=p>,</span> <span class=c1>// 用来创建和管理一组 FormControl
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>Validators</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/forms&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * submit 与 ngSubmit 的区别：
</span></span></span><span class=line><span class=cl><span class=cm> * submit 是 DOM 事件，ngSubmit 是 Angular 事件；
</span></span></span><span class=line><span class=cl><span class=cm> * 阻止默认行为需要在 submit 中进行；
</span></span></span><span class=line><span class=cl><span class=cm> * ngSubmit 比 submit 先触发；
</span></span></span><span class=line><span class=cl><span class=cm> * 两者的事件对象是一样的。
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-form&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;form [formGroup]=&#34;validateForm&#34; (ngSubmit)=&#34;handleSubmit($event)&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;label for=&#34;name&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;span&gt;Name:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;input id=&#34;name&#34; name=&#34;name&#34; type=&#34;text&#34; formControlName=&#34;name&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;label for=&#34;age&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;span&gt;Age:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;input id=&#34;age&#34; name=&#34;age&#34; type=&#34;text&#34; formControlName=&#34;age&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;div formGroupName=&#34;address&#34; alt=&#34;嵌套表单组&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;label for=&#34;street&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;span&gt;Street:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;input
</span></span></span><span class=line><span class=cl><span class=sb>            id=&#34;street&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            name=&#34;street&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            type=&#34;text&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            formControlName=&#34;street&#34;
</span></span></span><span class=line><span class=cl><span class=sb>          /&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;label for=&#34;city&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;span&gt;City:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;input id=&#34;city&#34; name=&#34;city&#34; type=&#34;text&#34; formControlName=&#34;city&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;label for=&#34;state&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;span&gt;State:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;input id=&#34;state&#34; name=&#34;state&#34; type=&#34;text&#34; formControlName=&#34;state&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;button (click)=&#34;handleFormUpdate()&#34;&gt;Update&lt;/button&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;button type=&#34;submit&#34;&gt;Submit&lt;/button&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/form&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>FormComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>validateForm</span>: <span class=kt>FormGroup</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>fb</span>: <span class=kt>FormBuilder</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 一般使用这种，并且对于“动态表单”，最好在初始化的时候就将所有表单属性列出
</span></span></span><span class=line><span class=cl><span class=cm>     * 而不是根据条件来动态的 addControl/removeControl
</span></span></span><span class=line><span class=cl><span class=cm>     * 因为那样，整个表单逻辑会非常不直观和零散
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>fb</span><span class=p>.</span><span class=nx>group</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;18&#39;</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>address</span>: <span class=kt>this.fb.group</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>street</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>city</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>state</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 很少使用这种
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FormGroup</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span>: <span class=kt>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span>: <span class=kt>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=s1>&#39;18&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>address</span>: <span class=kt>new</span> <span class=nx>FormGroup</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>street</span>: <span class=kt>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>city</span>: <span class=kt>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>state</span>: <span class=kt>new</span> <span class=nx>FormControl</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       * 表单不仅可以是一个对象，而且可以是一个数组
</span></span></span><span class=line><span class=cl><span class=cm>       * 不过在表单验证的时候，可能需要类型断言
</span></span></span><span class=line><span class=cl><span class=cm>       */</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>exampleForm</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>formBuilder</span><span class=p>.</span><span class=nx>array</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>      <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       * 通过 push 向数组表单中添加表单项
</span></span></span><span class=line><span class=cl><span class=cm>       * 还有 insert、removeAt 等方法
</span></span></span><span class=line><span class=cl><span class=cm>       */</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>exampleForm</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>formBuilder</span><span class=p>.</span><span class=nx>group</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=kr>type</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;SELF_EMPLOYED&#39;</span><span class=p>,</span> <span class=p>[]],</span>
</span></span><span class=line><span class=cl>          <span class=nx>accountName</span><span class=o>:</span> <span class=p>[</span><span class=nx>accountName</span><span class=p>,</span> <span class=p>[</span><span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>          <span class=nx>accountNo</span><span class=o>:</span> <span class=p>[</span><span class=nx>accountNo</span><span class=p>,</span> <span class=p>[</span><span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>          <span class=nx>bankName</span><span class=o>:</span> <span class=p>[</span><span class=nx>bankName</span><span class=p>,</span> <span class=p>[</span><span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>          <span class=nx>bankBranchName</span><span class=o>:</span> <span class=p>[</span><span class=nx>bankBranchName</span><span class=p>,</span> <span class=p>[</span><span class=nx>Validators</span><span class=p>.</span><span class=nx>required</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=nx>valueChanges</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>form</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 可以通过 valueChanges 来监听表单变化
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleSetDefault() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 单个赋值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;Bob&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;address&#39;</span><span class=p>).</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;street&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;Gongshu&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 批量赋值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=nx>patchValue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;male&#39;</span><span class=p>,</span> <span class=c1>// 不会抛出错误
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>age</span><span class=o>:</span> <span class=s1>&#39;21&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>address</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>city</span><span class=o>:</span> <span class=s1>&#39;Zhejiang&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleSubmit</span><span class=p>(</span><span class=nx>$event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>$event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>validArray</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>valid</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>,</span> <span class=nx>validArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>validArray</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=kc>false</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 对于嵌套多层的表单，可以使用递归进行验证
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>valid</span><span class=p>(</span><span class=nx>form</span><span class=p>,</span> <span class=nx>temp</span> <span class=o>=</span> <span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>form</span> <span class=k>instanceof</span> <span class=nx>FormGroup</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>form</span><span class=p>.</span><span class=nx>controls</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>control</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>valid</span><span class=p>(</span><span class=nx>form</span><span class=p>.</span><span class=nx>controls</span><span class=p>[</span><span class=nx>control</span><span class=p>],</span> <span class=nx>temp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>form</span> <span class=k>instanceof</span> <span class=nx>FormArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>form</span><span class=p>.</span><span class=nx>controls</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>control</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>valid</span><span class=p>(</span><span class=nx>control</span><span class=p>,</span> <span class=nx>temp</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>form</span> <span class=k>instanceof</span> <span class=nx>FormControl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>form</span><span class=p>.</span><span class=nx>markAsDirty</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>form</span><span class=p>.</span><span class=nx>updateValueAndValidity</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>temp</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>form</span><span class=p>.</span><span class=nx>disabled</span> <span class=o>?</span> <span class=kc>true</span> <span class=o>:</span> <span class=nx>form</span><span class=p>.</span><span class=nx>valid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=路由>路由</h2><p>Router 是一个提供导航和操纵 URL 能力的 NgModule；通过将浏览器 URL 解释为更改视图的操作指令来启用导航：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Route</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>canActivate?</span>: <span class=kt>any</span><span class=p>[];</span> <span class=c1>// 调用 canActivate 钩子来确定“是否激活匹配到的路由”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>canActivateChild?</span>: <span class=kt>any</span><span class=p>[];</span> <span class=c1>// 调用 canActivateChild 钩子来确定“路径参数的变化时，是否激活匹配到的子路由”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>canDeactivate?</span>: <span class=kt>any</span><span class=p>[];</span> <span class=c1>// 调用 canDeactivate 钩子来确定“是否允许离开当前路由”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>canLoad?</span>: <span class=kt>any</span><span class=p>[];</span> <span class=c1>// 调用 canLoad 钩子来确定“是否允许加载‘懒加载’的模块”
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>children?</span>: <span class=kt>Route</span><span class=p>[];</span> <span class=c1>// 嵌套子路由配置
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>component?</span>: <span class=kt>Type</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;;</span> <span class=c1>// 匹配之后，要实例化的组件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>data?</span>: <span class=kt>Data</span><span class=p>;</span> <span class=c1>// 携带的数据，可通过 ActivatedRoute 获取
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>loadChildren?</span>: <span class=kt>LoadChildren</span><span class=p>;</span> <span class=c1>// 懒加载模块
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>matcher?</span>: <span class=kt>UrlMatcher</span><span class=p>;</span> <span class=c1>// 自定义匹配算
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>outlet?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 当同级有多个 &lt;router-outlet name=&#34;xxx&#34;/&gt; 时，指定从渲染出口
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>path?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 匹配路径
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>pathMatch?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 路径匹配策略，prefix（默认）｜full
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>redirectTo?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 匹配之后，要重定向的路径
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>resolve?</span>: <span class=kt>ResolveData</span><span class=p>;</span> <span class=c1>// 与路由关联的解析数据
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>runGuardsAndResolvers?</span>: <span class=kt>RunGuardsAndResolvers</span><span class=p>;</span> <span class=c1>// 定义 Guards 和 Resolvers 的运行时机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 路由配置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>routes</span>: <span class=kt>Route</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/login&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>canActivate</span><span class=o>:</span> <span class=p>[</span><span class=nx>LoginGuard</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 懒加载只适用于“模块”，不适用于“组件”
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>loadChildren</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=kr>import</span><span class=p>(</span><span class=s1>&#39;./login/login.module&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>m</span> <span class=o>=&gt;</span> <span class=nx>m</span><span class=p>.</span><span class=nx>LoginModule</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;**&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>component</span>: <span class=kt>NotFoundComponent</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>@NgModule</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// forRoot 表示“这是一个根路由模块”，在一个应用中只会使用一次
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>RouterModule</span><span class=p>.</span><span class=nx>forRoot</span><span class=p>(</span><span class=nx>routes</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       * initialNavigation 取值：
</span></span></span><span class=line><span class=cl><span class=cm>       * enabled/enabledBlocking，引导程序被阻止，直到初始导航完成，一般 SSR 的时候才用得到
</span></span></span><span class=line><span class=cl><span class=cm>       * enabledNonBlocking，引导程序不会被阻塞
</span></span></span><span class=line><span class=cl><span class=cm>       * disabled，不执行初始导航
</span></span></span><span class=line><span class=cl><span class=cm>       */</span>
</span></span><span class=line><span class=cl>      <span class=nx>initialNavigation</span><span class=o>:</span> <span class=s1>&#39;enabledNonBlocking&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>anchorScrolling</span><span class=o>:</span> <span class=s1>&#39;enabled&#39;</span><span class=p>,</span> <span class=c1>// 当 URL 中有锚点时，是否滚动到锚点（&#39;disabled&#39;|&#39;enabled&#39;|&#39;top&#39;）
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>enableTracing</span>: <span class=kt>false</span><span class=p>,</span> <span class=c1>// 为 true 时，Router 会将每次导航过程中触发的“路由生命周期”输出到控制台
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>onSameUrlNavigation</span><span class=o>:</span> <span class=s1>&#39;ignore&#39;</span><span class=p>,</span> <span class=c1>// 当导航到当前地址是的行为（&#39;reload&#39;|&#39;ignore&#39;）
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>paramsInheritanceStrategy</span><span class=o>:</span> <span class=s1>&#39;emptyOnly&#39;</span><span class=p>,</span> <span class=c1>// 如何将参数、数据从父路由合并到子路由
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>preloadingStrategy</span><span class=o>:</span> <span class=s1>&#39;NoPreloading&#39;</span><span class=p>,</span> <span class=c1>// 预加载策略
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>scrollPositionRestoration</span><span class=o>:</span> <span class=s1>&#39;enabled&#39;</span><span class=p>,</span> <span class=c1>// 发生“导航回退”是否重置滚动位置（&#39;disabled&#39;|&#39;enabled&#39;|&#39;top&#39;）
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>relativeLinkResolution</span><span class=o>:</span> <span class=s1>&#39;legacy&#39;</span><span class=p>,</span> <span class=c1>// 相对路径的导航策略
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>urlUpdateStrategy</span><span class=o>:</span> <span class=s1>&#39;deferred&#39;</span><span class=p>,</span> <span class=c1>// 浏览器地址栏的更新策略（默认在导航成功之后再更新）
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>useHash</span>: <span class=kt>false</span><span class=p>,</span> <span class=c1>// 环境不支持 History API 时，可使用哈希导航
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>errorHandler</span>: <span class=kt>error</span> <span class=o>=&gt;</span> <span class=nx>error</span><span class=p>,</span> <span class=c1>// 自定义错误处理
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>scrollOffset</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=c1>// 路由导航后的滚动偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>exports</span><span class=o>:</span> <span class=p>[</span><span class=nx>RouterModule</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>AppRoutingModule</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>路由钩子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>providedIn</span><span class=o>:</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>LoginGuard</span> <span class=kr>implements</span> <span class=nx>CanActive</span><span class=p>,</span> <span class=nx>CanActiveChild</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>canActive</span><span class=p>(</span><span class=nx>route</span>: <span class=kt>ActivatedRouteSnapshot</span><span class=p>,</span> <span class=nx>state</span>: <span class=kt>RouterStateSnapshot</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>auth</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>authService</span><span class=p>.</span><span class=nx>currentAuth</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>authService</span><span class=p>.</span><span class=nx>currentUser</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>url</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>path</span> <span class=o>===</span> <span class=s1>&#39;login&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>sessionStorage</span><span class=p>.</span><span class=nx>removeItem</span><span class=p>(</span><span class=s1>&#39;auth&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>sessionStorage</span><span class=p>.</span><span class=nx>removeItem</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>auth</span> <span class=o>||</span> <span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在组件中获取路由信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ActivatedRoute</span><span class=p>,</span> <span class=nx>NavigationEnd</span><span class=p>,</span> <span class=nx>Router</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/router&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-general&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>GeneralComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>isExclusive</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>get</span> <span class=nx>currentQueryParams() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 可以通过 router 获取查询参数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>parseUrl</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>queryParams</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>parseUrl</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>queryParams</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>route</span>: <span class=kt>ActivatedRoute</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>router</span>: <span class=kt>Router</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在组件初始化的时候，订阅路由查询参数的变化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handleFetchData</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 订阅路由事件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>e</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>e</span> <span class=k>instanceof</span> <span class=nx>NavigationEnd</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>handleNavigationEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleFetchData</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleNavigationEnd() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在导航结束时
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>exclusive</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>currentQueryParams</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>isExclusive</span> <span class=o>=</span> <span class=nb>String</span><span class=p>(</span><span class=nx>exclusive</span><span class=p>)</span> <span class=o>===</span> <span class=s1>&#39;true&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleSwitchUrl</span><span class=p>(</span><span class=nx>$event</span><span class=p>,</span> <span class=p>{</span> <span class=nx>exclusive</span> <span class=o>=</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>path</span> <span class=o>=</span> <span class=kc>null</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>$event</span><span class=p>.</span><span class=nx>stopPropagation</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>temp</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>queryParams</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>queryParamsHandling</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>path</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>temp</span> <span class=o>=</span> <span class=p>[</span><span class=nx>path</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>exclusive</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>queryParams</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>exclusive</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 相对于当前路由进行导航并重置 URL 中的查询参数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>navigate</span><span class=p>(</span><span class=nx>temp</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>relativeTo</span>: <span class=kt>this.route</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>queryParams</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>queryParamsHandling</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=依赖注入>依赖注入</h2><p>依赖是指系统中的各个组成部分之间的相互关系；具体到 Angular，是指某个 class 执行其功能“所需的”服务（@Injectable）或对象。</p><p>在传统模式中，如果组件 A 依赖服务 B，A 会在内部创建一个 B 的实例；在依赖注入模式中，依赖项 B 会通过 A 的 constructor 注入（默认行为是 new 调用），保存在 A 的私有属性上。</p><p>当 class 需要某个依赖时，该依赖就会作为参数添加到 class 的构造函数中。当 Angular 实例化 class 时，DI 会在“注入器树”中查找（从局部开始，向上冒泡，直到 root）provider；如果没有找到 provider，会报错。</p><p>如果要保证外部注入的服务是自己（当前 class）独有的（<a class=link href=https://angular.cn/guide/dependency-injection-in-action#multiple-service-instances-sandboxing target=_blank rel=noopener>
沙箱式隔离
</a>），只需在自己的元数据 providers 中列出 Service 即可（就能拥有自己独有的服务实例）。</p><p>如果“允许依赖缺失”或者需要“限制依赖查找范围”，可以使用修饰符更改默认的依赖查找机制：</p><ul><li>@Host 表示禁止在“请求该依赖的组件”以上查找依赖；</li><li>@Self 表示只在该组件的注入器中查找提供者，就是仅在 @Component({providers:[]}) 中查找，找不到就报错；</li><li>@SkipSelf 表示跳过局部注入器，向上查找，与 @Self 相反；</li><li>@Optional 表示找不到依赖就返回 null，即使找不到，也不报错。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果不需要“独有”服务实例，就不需要 providers
</span></span></span><span class=line><span class=cl><span class=cm>   * 在每个 @Component({providers:[xxx]}) 中单独声明
</span></span></span><span class=line><span class=cl><span class=cm>   * 每个 Component 就独享这个 Service 实例
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>provide</span>: <span class=kt>AaService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 为 DI 令牌（依赖的标识）关联一个“固定的值”
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>useValue</span>: <span class=kt>123</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>provide</span>: <span class=kt>BbService</span><span class=p>,</span> <span class=c1>// DI 令牌
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       * 为公共类/默认类换上一个“替代实现”
</span></span></span><span class=line><span class=cl><span class=cm>       * 令牌和注入内容不一定“同名”
</span></span></span><span class=line><span class=cl><span class=cm>       */</span>
</span></span><span class=line><span class=cl>      <span class=nx>useClass</span>: <span class=kt>CcService</span> <span class=c1>// DI 内容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>provide</span>: <span class=kt>AliasService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       * 为服务创建别名，提供了两种途径来访问同一服务对象
</span></span></span><span class=line><span class=cl><span class=cm>       * 也可以用来“收窄/简化”BbService
</span></span></span><span class=line><span class=cl><span class=cm>       */</span>
</span></span><span class=line><span class=cl>      <span class=nx>useExisting</span>: <span class=kt>BbService</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>provide</span>: <span class=kt>Example</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 通过“工厂函数”来创建依赖实例
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>useFactory</span>: <span class=kt>user</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=k>new</span> <span class=nx>SignUp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>SignIn</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 用于指定“工厂函数”所使用的依赖
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>deps</span><span class=o>:</span> <span class=p>[</span><span class=nx>User</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>DdService</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ExampleComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kd>@Inject</span><span class=p>(</span><span class=nx>AaService</span><span class=p>)</span> <span class=kr>private</span> <span class=nx>aa</span>: <span class=kt>any</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kd>@SkipSelf</span><span class=p>()</span> <span class=kr>private</span> <span class=nx>bb</span>: <span class=kt>BbService</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>eg</span>: <span class=kt>Example</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=双向绑定>双向绑定</h2><p>Angular 也有 Vue 中的 v-model 机制（modelValue/update:modelValue），语法为 [(value)]；实现思路同样也是基于“组件传值”和“自定义事件”（语法糖）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&lt;div&gt;&lt;app-input-model [(example)]=&#34;exampleValue&#34;&gt;&lt;/app-input-model&gt;&lt;span&gt;{{ exampleValue }}&lt;/span&gt;&lt;/div&gt;&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>FormComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>exampleValue</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&lt;input type=&#34;text&#34; [value]=&#34;example&#34; (input)=&#34;handleInput($event)&#34; /&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-input-model&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InputModelComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>example</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 事件名称必须和 @Input 属性相对应，为 xxxChange
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>exampleChange</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleInput</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 官方文档中，在这里直接对 example 进行了修改，我表示不理解
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>exampleChange</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=绑定语法>绑定语法</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>my-component</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span><span class=na>component</span>
</span></span><span class=line><span class=cl>  <span class=err>[@</span><span class=na>animation</span><span class=err>]=&#34;</span><span class=na>animation</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[(</span><span class=na>banana</span><span class=err>)]=&#34;</span><span class=na>banana</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>options</span><span class=err>]=&#34;</span><span class=na>options</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>output</span><span class=err>)=&#34;</span><span class=na>onOutput</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>click</span><span class=err>)=&#34;</span><span class=na>onClick</span><span class=err>()&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&lt;/</span><span class=nt>my-component</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 如果你有强迫症的话，Ng 支持另一种模版语法 --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>my-component</span>
</span></span><span class=line><span class=cl>  <span class=na>ref-component</span>
</span></span><span class=line><span class=cl>  <span class=na>bind-animate-animation</span><span class=o>=</span><span class=s>&#34;animation&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>bindon-banana</span><span class=o>=</span><span class=s>&#34;banana&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>bind-options</span><span class=o>=</span><span class=s>&#34;options&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>on-output</span><span class=o>=</span><span class=s>&#34;onOutput($event)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>on-click</span><span class=o>=</span><span class=s>&#34;onClick()&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&lt;/</span><span class=nt>my-component</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=模版变量>模版变量</h2><p>模版变量，顾名思义，就是存在于组件模版中的变量；模版变量可以引用：元素、指令、组件等：</p><ul><li>如果在组件上声明变量，该变量就会引用该组件实例；</li><li>如果在原生 HTML 标签上声明变量，该变量就会引用该元素；</li><li>如果你在 &lt;ng-template/> 上声明变量，该变量就会引用一个 TemplateRef 实例；</li><li>如果该变量在右侧指定了一个名字（例如，#var=&ldquo;ngModel&rdquo;），该变量就会引用所在元素上具有这个 exportAs 名字的指令或组件。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- # 声明了一个模版变量 phone --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=err>#</span><span class=na>phone</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;phone number&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- button 通过模版变量获取到了 input 的 value --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>button</span> <span class=err>(</span><span class=na>click</span><span class=err>)=&#34;</span><span class=na>callPhone</span><span class=err>(</span><span class=na>phone</span><span class=err>.</span><span class=na>value</span><span class=err>)&#34;</span><span class=p>&gt;</span>take a call<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 模版输入变量 --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>heroRef</span> <span class=na>let-hero</span> <span class=na>let-i</span><span class=o>=</span><span class=s>&#34;index&#34;</span> <span class=na>let-even</span><span class=o>=</span><span class=s>&#34;!isOdd&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>span</span> <span class=err>[</span><span class=na>class</span><span class=err>]=&#34;{</span> <span class=err>&#39;</span><span class=na>even-row</span><span class=err>&#39;</span><span class=na>:</span> <span class=na>even</span> <span class=err>}&#34;</span><span class=p>&gt;</span>{{ i }}: {{ hero.name }}<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>模版变量可以在“包含此模板变量”的模板中的任何地方引用它；既然使用模版变量的前提是“包含此模板变量”，那么决定模版边界的“结构型指令（例如，ngIf、ngFor、&lt;ng-template/>）”也决定了模版变量的<strong>作用域</strong>。</p><h2 id=网络请求>网络请求</h2><p>要使用 HttpClient，需要在模块中导入 HttpClientModule；一般情况下，在 AppModule 导入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BrowserModule</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/platform-browser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>HttpClientModule</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/common/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@NgModule</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>providers</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * HTTP_INTERCEPTORS 是 InjectionToken 实例
</span></span></span><span class=line><span class=cl><span class=cm>     * 可以作为各个依赖项的唯一标识，方便依赖项被查找
</span></span></span><span class=line><span class=cl><span class=cm>     * 当然，唯一标识不一定要是 InjectionToken 实例
</span></span></span><span class=line><span class=cl><span class=cm>     * 可以被“唯一识别”就好，比如，NZ_I18N
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>provide</span>: <span class=kt>NZ_I18N</span><span class=p>,</span> <span class=nx>useValue</span>: <span class=kt>zh_CN</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 使用一个 InjectionToken 初始化多个 provider
</span></span></span><span class=line><span class=cl><span class=cm>     * 酱紫就可以通过 @Inject(HTTP_INTERCEPTORS) 获取多个 provider
</span></span></span><span class=line><span class=cl><span class=cm>     * 如果 multi: false，后边的 provide 会覆盖前边的 provider
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>provide</span>: <span class=kt>HTTP_INTERCEPTORS</span><span class=p>,</span> <span class=nx>useClass</span>: <span class=kt>SpinInterceptor</span><span class=p>,</span> <span class=nx>multi</span>: <span class=kt>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>provide</span>: <span class=kt>HTTP_INTERCEPTORS</span><span class=p>,</span> <span class=nx>useClass</span>: <span class=kt>ErrorInterceptor</span><span class=p>,</span> <span class=nx>multi</span>: <span class=kt>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>[</span><span class=nx>BrowserModule</span><span class=p>,</span> <span class=nx>HttpClientModule</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>declarations</span><span class=o>:</span> <span class=p>[</span><span class=nx>AppComponent</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>bootstrap</span><span class=o>:</span> <span class=p>[</span><span class=nx>AppComponent</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>AppModule</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>发起 HTTP 请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>HttpClient</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>HttpErrorResponse</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>HttpHeaders</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>HttpParams</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/common/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>catchError</span><span class=p>,</span> <span class=nx>retry</span><span class=p>,</span> <span class=nx>throwError</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/operators&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Injectable</span><span class=p>({})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ApiService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * HttpClient 返回的 Observer 是“冷的”，不需要手动 unsubscribe
</span></span></span><span class=line><span class=cl><span class=cm>   * 请求成功时，会在 responseObserver.next 调用之后，调用 responseObserver.complete
</span></span></span><span class=line><span class=cl><span class=cm>   * 请求失败时，会调用 responseObserver.error
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>http</span>: <span class=kt>HttpClient</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 自定义请求头
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>headers</span>: <span class=kt>new</span> <span class=nx>HttpHeaders</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;multipart/form-data&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Authorization</span><span class=o>:</span> <span class=s1>&#39;au9mtPT3WwkDxfs&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 指定要返回的响应内容（联合类型：&#39;body&#39;|&#39;events&#39;|&#39;response&#39;）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>observe</span><span class=o>:</span> <span class=s1>&#39;body&#39;</span> <span class=kr>as</span> <span class=kr>const</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 查询参数，会被 encode 进 URL 中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>params</span>: <span class=kt>new</span> <span class=nx>HttpParams</span><span class=p>({}),</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 是否回报请求进度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>reportProgress</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 指定返回数据的格式（联合类型：&#39;arraybuffer&#39;|&#39;blob&#39;|&#39;json&#39;|&#39;text&#39;）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>responseType</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span> <span class=kr>as</span> <span class=kr>const</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>withCredentials</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>getConfig</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>http</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>environment</span><span class=p>.</span><span class=nx>apiHost</span><span class=si>}</span><span class=sb>/api/v1`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>params</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>retry</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span> <span class=c1>// 如果请求失败，最多重复请求三次
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>catchError</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>handleError</span><span class=p>)</span> <span class=c1>// 错误处理函数
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>updateConfig</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>http</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=sb>`</span><span class=si>${</span><span class=nx>environment</span><span class=p>.</span><span class=nx>apiHost</span><span class=si>}</span><span class=sb>/api/v1`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span> <span class=cm>/* 请求体 */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>options</span> <span class=cm>/* 请求选项 */</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>modifyConfig</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>http</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=sb>`</span><span class=si>${</span><span class=nx>environment</span><span class=p>.</span><span class=nx>apiHost</span><span class=si>}</span><span class=sb>/api/v1`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span> <span class=cm>/* 请求体 */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>options</span> <span class=cm>/* 请求选项 */</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>deleteConfig</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>http</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>environment</span><span class=p>.</span><span class=nx>apiHost</span><span class=si>}</span><span class=sb>/api/v1`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>params</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>401</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>throwError</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=特殊标签>特殊标签</h2><p>&lt;ng-container/>，类似于 Vue 模版中的 &lt;template/> 或者 React.Fragment；无实际意义，用来对模板片段按照展示逻辑进行<strong>分组</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- ng-container 最常使用的场景就是和 *ngFor 搭配 --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>nz-select</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of branchList&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>nz-option</span>
</span></span><span class=line><span class=cl>      <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;item.show&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>[</span><span class=na>nzValue</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>brabank_id</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>[</span><span class=na>nzLabel</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>brabank_name</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;&lt;/</span><span class=nt>nz-option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>nz-select</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>&lt;ng-template/>，用来<strong>定义</strong>（声明）模版片段；默认情况下，定义的模版片段不会直接渲染，需要指定渲染的位置；一般配合结构性指令使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- 当 seconds 被重置时，会条件渲染 #actionResendSMS 片段 --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;seconds !== 0; else actionResendSMS&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>接受短信大约需要 {{ seconds }} 秒<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>actionResendSMS</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>a</span> <span class=err>(</span><span class=na>click</span><span class=err>)=&#34;</span><span class=na>handleSendSMS</span><span class=err>()&#34;</span><span class=p>&gt;</span>重新获取验证码<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>&lt;ng-container/> 搭配 &lt;ng-template/> 可以构造<strong>作用域插槽</strong>，实现逻辑与 UI 的分离，从而实现逻辑复用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 封装逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-user-list-slot&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;ng-container
</span></span></span><span class=line><span class=cl><span class=sb>      *ngTemplateOutlet=&#34;userListSlot; context: temp&#34;
</span></span></span><span class=line><span class=cl><span class=sb>    &gt;&lt;/ng-container&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserListSlotComponent</span> <span class=kr>implements</span> <span class=nx>OnChange</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 通过 userListSlot 指向一段 HTML 片段
</span></span></span><span class=line><span class=cl><span class=cm>   * 可以使用 @ContentChild(TemplateRef)
</span></span></span><span class=line><span class=cl><span class=cm>   * 那样无需我们指定“投射内容”
</span></span></span><span class=line><span class=cl><span class=cm>   * 标签包含的所有 HTML
</span></span></span><span class=line><span class=cl><span class=cm>   * 都是“投射内容”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>userListSlot</span>: <span class=kt>TemplateRef</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>formatFn</span> <span class=o>=</span> <span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>groupId</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>updated</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>temp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>loading</span>: <span class=kt>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>list</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>apiService</span>: <span class=kt>ApiService</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnChanges</span><span class=p>(</span><span class=nx>changes</span>: <span class=kt>SimpleChanges</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>changes</span><span class=o>?</span><span class=p>.</span><span class=nx>groupId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>fetchUserList</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>fetchUserList() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>temp</span><span class=p>.</span><span class=nx>loading</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiService</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>getUserList</span><span class=p>({</span> <span class=nx>groupId</span>: <span class=kt>this.groupId</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>subscribe</span><span class=p>(({</span> <span class=nx>success</span> <span class=o>=</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>[]</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>temp</span><span class=p>.</span><span class=nx>list</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>formatFn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>temp</span><span class=p>.</span><span class=nx>list</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>temp</span><span class=p>.</span><span class=nx>loading</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>updated</span><span class=p>.</span><span class=nx>emit</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=p>...</span><span class=nx>temp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>originalData</span>: <span class=kt>data</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 使用插槽
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;div&gt;...&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;app-user-list-slot
</span></span></span><span class=line><span class=cl><span class=sb>      [userListSlot]=&#34;userListTemplate&#34;
</span></span></span><span class=line><span class=cl><span class=sb>      [formatFn]=&#34;userListFormatter&#34;
</span></span></span><span class=line><span class=cl><span class=sb>      [groupId]=&#34;groupId&#34;
</span></span></span><span class=line><span class=cl><span class=sb>      (updated)=&#34;(handleUserListUpdated)&#34;
</span></span></span><span class=line><span class=cl><span class=sb>    &gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;ng-template
</span></span></span><span class=line><span class=cl><span class=sb>        #userListTemplate
</span></span></span><span class=line><span class=cl><span class=sb>        let-userList=&#34;list&#34;
</span></span></span><span class=line><span class=cl><span class=sb>        let-loadingUserList=&#34;loading&#34;
</span></span></span><span class=line><span class=cl><span class=sb>      &gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;nz-select [nzLoading]=&#34;loadingUserList&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;nz-option
</span></span></span><span class=line><span class=cl><span class=sb>            [nzValue]=&#34;option.id&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            [nzLabel]=&#34;option.name&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            *ngFor=&#34;let option of userList&#34;
</span></span></span><span class=line><span class=cl><span class=sb>          &gt;&lt;/nz-option&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;/nz-select&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;/ng-template&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/app-user-list-slot&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;div&gt;...&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DormitoryConfigureComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>groupId</span> <span class=o>=</span> <span class=mi>21</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>userListFormatter</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>handleUserListUpdated</span><span class=p>({</span> <span class=nx>originalData</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>originalData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>&lt;ng-content/>，使用在组件内部，可以使组件<a class=link href=https://angular.cn/guide/content-projection target=_blank rel=noopener>
“接受外部插入进来的内容”
</a>，相当于 Vue 模版中的 &lt;slot/>：</p><ol><li>Angular 中并没有“<strong>具名插槽</strong>”的概念，但是 &lt;ng-content/> 有一个 select 属性（CSS 选择器，不支持变量），可以起到对外部插入的内容进行<strong>过滤</strong>的作用；</li><li>相比于 &lt;router-outlet/>，&lt;ng-content/> 展示的内容是由<strong>外部插入</strong>的，&lt;router-outlet/> 展示的内容是由路由表<strong>指定</strong>的；</li><li>如果你的组件包含不带 select 属性的 &lt;ng-content/> 元素，则该实例将接收所有与其他 &lt;ng-content/> 元素都不匹配的投影组件。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- 例如，nz-button 的 template --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>i</span> <span class=na>nz-icon</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;loading&#34;</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;nzLoading&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-content</span><span class=p>&gt;&lt;/</span><span class=nt>ng-content</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 使用时 --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>nz-button</span><span class=p>&gt;</span>例子<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  渲染的结果，“例子”会被插入到 ng-content
</span></span></span><span class=line><span class=cl><span class=c>  当作 Vue 中的“具名插槽”理解就好
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>nz-button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>i</span> <span class=na>nz-icon</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;loading&#34;</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;nzLoading&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  例子
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=特殊选择器>特殊选择器</h2><ul><li>::ng-deep、/deep/、>>>，将样式应用到全局；所以请在 ::ng-deep 之前带上 :host，防止污染全局样式；</li><li>:host、:host(condition)，宿主元素选择器/当“宿主元素”满足 condition 时；</li><li>:host-context(condition)，当“宿主的祖先元素”满足 condition 时。</li></ul><h2 id=contentchild-与-viewchild>ContentChild 与 ViewChild</h2><p>@ViewChild() 从当前<strong>组件模版中</strong>获取组件对象（Vue/React 中 ref 的功能）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;user-list&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;nz-spin&gt;&lt;form #form&gt;&lt;/form&gt;&lt;user-detail&gt;&lt;/user-detail&gt;&lt;/nz-spin&gt;&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>UserListComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span><span class=p>,</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=nx>NzSpinComponent</span><span class=p>)</span> <span class=nx>nzSpinRef</span>: <span class=kt>NzSpinComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=s1>&#39;form&#39;</span><span class=p>)</span> <span class=nx>formRef</span>: <span class=kt>ElementRef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在 ngOnInit 钩子中是获取不到的
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>nzSpinRef</span><span class=p>);</span> <span class=c1>// undefined
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>formRef</span><span class=p>);</span> <span class=c1>// undefined
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterViewInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 通过 ViewChild 从当前模版中获取组件实例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>nzSpinRef</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>formRef</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>@ContentChild() 从<strong>当前组件模版的外部投射进来的内容（类似 React 中的 props.children）中</strong>获取组件对象：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;user-list&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&lt;user-detail&gt;&lt;span #span&gt;用户交易&lt;/span&gt;&lt;user-trade&gt;&lt;/user-trade&gt;&lt;/user-detail&gt;&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>UserListComponent</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;user-detail&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&lt;h2&gt;用户详情&lt;/h2&gt;&lt;div class=&#39;user-detail&#39;&gt;&lt;ng-content&gt;&lt;/ng-content&gt;&lt;/div&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>UserDetailComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span><span class=p>,</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ContentChild</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>)</span> <span class=nx>spanRef</span>: <span class=kt>ElementRef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ContentChild</span><span class=p>(</span><span class=nx>UserTradeComponent</span><span class=p>)</span> <span class=nx>userTradeRef</span>: <span class=kt>UserTradeComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在 ngOnInit 钩子中是获取不到的
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>spanRef</span><span class=p>);</span> <span class=c1>// undefined
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>userTradeRef</span><span class=p>);</span> <span class=c1>// undefined
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterViewInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 从 ng-content 中获取组件/DOM 元素
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>spanRef</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>userTradeRef</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>说明：</p><ul><li>ContentChild 和 ViewChild 指向的类型不同（一个在当前模版中查找，一个在当前模版的外部投射内容中查找）；</li><li>ViewChild 对应的是 ngAfterViewInit、ngAfterViewChecked；</li><li>ContentChild 对应的是 ngAfterContentInit、ngAfterContentChecked；</li><li>AfterView 关心的是 ViewChildren，ViewChildren 的元素标签会出现在当前组件的模版中；</li><li>AfterContent 关心的是 ContentChildren，ContentChildren 被投射进当前组件中。</li></ul><h2 id=changedetectorref>ChangeDetectorRef</h2><p>首先，每个组件都有自己的变更检测器，一个应用包含多个组件，组件之间的层级关系形成了“组件树”。</p><p>Angular 的默认检测机制是：当一个组件发生变更时，无论它在组件树的什么位置，都会触发树中的所有的变更检测器；Ng 会从“自顶向下”，扫描树所有节点。</p><p>ChangeDetectorRef 为组件实例提供了<strong>自定义变更检测功能</strong>，可以将组件从<strong>变更检测树</strong>中添加或删除；ChangeDetectorRef 提供了五个方法：</p><ol><li>markForCheck()，在 ChangeDetectionStrategy.OnPush 策略下，将视图标记为“需要变更检测”；</li><li>detach()，将组件从<strong>变更检测树</strong>中<strong>删除</strong>，在 reattach 被调用之前，不会再进行变更检测；</li><li>reattach()，将之前被 detach 的组件<strong>添加</strong>到<strong>变更检测树</strong>中；</li><li>checkNoChanges()，对该视图及其子视图进行变更检测，如有变化，报异常（仅在开发环境有效）；</li><li>detectChanges()，对该视图及其子视图<strong>手动</strong>进行一次变更检测。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DataListProvider</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>get</span> <span class=nx>data() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 假设数据量很大，并且变化频繁
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;li *ngFor=&#34;let item of dataProvider.data&#34;&gt;{{ item }}&lt;/li&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>GiantList</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>ref</span>: <span class=kt>ChangeDetectorRef</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span> <span class=nx>dataProvider</span>: <span class=kt>DataListProvider</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 放弃 Ng 的变更检测策略
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ref</span><span class=p>.</span><span class=nx>detach</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 间隔 5 秒手动进行变更检测，提高应用性能
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>ref</span><span class=p>.</span><span class=nx>detectChanges</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在开发的过程中，可能会遇到**<a class=link href=https://angular.cn/errors/NG0100 target=_blank rel=noopener>
NG100 错误
</a>**，特别是在 ngAfterViewInit 钩子中执行“手动”渲染操作时；原因是，在开发模式下，每次"变更检测"后，都会执行一次"附加检查"，如果在附加检查过程中，视图和"变更检测"后的视图不一致，会报 NG100 错误。</p><p>解决方法是，将同步渲染逻辑改为异步（宏任务、微任务均可），或者同步调用 detectChanges 重新进行变更检测。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;ng-container #vcf&gt;&lt;/ng-container&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>CodesComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span><span class=p>,</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ContentChild</span><span class=p>(</span><span class=nx>TemplateRef</span><span class=p>)</span> <span class=nx>content</span>: <span class=kt>TemplateRef</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=s1>&#39;vcf&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>read</span>: <span class=kt>ViewContainerRef</span> <span class=p>})</span> <span class=nx>vcf</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>list</span>: <span class=kt>CodeItem</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>cdf</span>: <span class=kt>ChangeDetectorRef</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngAfterViewInit() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>?</span><span class=p>.</span><span class=nx>vcf</span><span class=o>?</span><span class=p>.</span><span class=nx>createEmbeddedView</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>handleChecked</span><span class=o>:</span> <span class=p>(</span><span class=nx>v</span><span class=p>,</span> <span class=nx>o</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleChecked</span><span class=p>(</span><span class=nx>o</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>$implicit</span>: <span class=kt>this.list</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 渲染完后，进行一次变更检测
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>cdf</span><span class=p>.</span><span class=nx>detectChanges</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=rxreactivexjs>Rx(ReactiveX)JS</h2><p>RxJS 是 ReactiveX 在 JS 中的实现，相似的还有 RxJava、RxSwift&mldr;；ReactiveX 是 FRP（函数响应式编程）的践行者。</p><h3 id=操作符>操作符</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 创建器，用来创建“流（数据序列）”，返回值是一个 Observable 对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>def</span><span class=p>,</span> <span class=kr>from</span><span class=p>,</span> <span class=nx>fromEvent</span><span class=p>,</span> <span class=nx>interval</span><span class=p>,</span> <span class=k>of</span><span class=p>,</span> <span class=nx>range</span><span class=p>,</span> <span class=nx>timer</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>fromPromise</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/internal/observable/fromPromise&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 操作符，用来处理“流”
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>buffer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>bufferCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>bufferTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>catchError</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>combineLatest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>concat</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>distinct</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>distinctUntilChanged</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>filter</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>finalize</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>first</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>forkJoin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>last</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>map</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>merge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>race</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>zip</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/operators&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=nx>Observable</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;((</span><span class=nx>observer</span>: <span class=kt>Observer</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 任何时间，都可以通过 next 将值传入“流”中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>observer</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * of 可以将“单一值”创建为“流”
</span></span></span><span class=line><span class=cl><span class=cm> * “单一值”可以为任何数据类型
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=k>of</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>===</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 冷 Observable 必须被 subscribe 之后才会“产生”数据
</span></span></span><span class=line><span class=cl><span class=cm>   * 如果没有 subscribe，之前的 pipe 就不会执行
</span></span></span><span class=line><span class=cl><span class=cm>   * 所以，在 Angular 中，对同一接口多次 subscribe 会导致发起多次请求
</span></span></span><span class=line><span class=cl><span class=cm>   * subscribe 表示“可观察对象”与“观察者”之间“建立了联系”
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span> <span class=c1>// 3 9 15
</span></span></span><span class=line><span class=cl><span class=c1>// from 可以将数组的每一项放入“流”中
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>from</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>===</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span> <span class=c1>// 3 9 15
</span></span></span><span class=line><span class=cl><span class=c1>// fromEvent 可以替代 addEventListener，是“热”的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fromEvent$</span> <span class=o>=</span> <span class=nx>fromEvent</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#title&#39;</span><span class=p>),</span> <span class=s1>&#39;click&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>fromEvent$</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span> <span class=c1>// PointerEvent
</span></span></span><span class=line><span class=cl><span class=c1>// range 可以从“范围”产生“流”
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>===</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span> <span class=c1>// 3 9 15
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>p</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Promise Begin...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;Promise Resolved...&#39;</span><span class=p>),</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * fromPromise 接受一个 Promise 实例
</span></span></span><span class=line><span class=cl><span class=cm> * 当这个 Promise 状态确定之后，将输出值放入“流”中
</span></span></span><span class=line><span class=cl><span class=cm> * 即使没有 subscribe，这个 Promise 也会执行
</span></span></span><span class=line><span class=cl><span class=cm> * 从 6.0 开始，可以使用 from 替代 fromPromise
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>fromPromise</span><span class=p>(</span><span class=nx>p</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * defer 用来“惰性地”创建“流”
</span></span></span><span class=line><span class=cl><span class=cm> * 他接受一个“产生流”的“工厂函数”
</span></span></span><span class=line><span class=cl><span class=cm> * 当调用 defer 时，“流”还不存在，“流”会被“按需”创建
</span></span></span><span class=line><span class=cl><span class=cm> * 当“流”被“需要”的时候，才会调用“工厂函数”，产生“流”
</span></span></span><span class=line><span class=cl><span class=cm> * 只要没有 subscribe，“工厂函数”就不会执行，Promise 也就不会执行
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>defer</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=kr>from</span><span class=p>(</span><span class=nx>p</span><span class=p>)).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * timer(首次等待时间，重复间隔时间) 用来创建“定时器流”
</span></span></span><span class=line><span class=cl><span class=cm> * 他创建的是一种“无尽流”（务必要在适当的时候取消订阅）
</span></span></span><span class=line><span class=cl><span class=cm> * 数据会不断重复的被放入“流”中
</span></span></span><span class=line><span class=cl><span class=cm> * 有点像 setInterval
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>timer</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span> <span class=c1>// 等待 3 秒：0 1 2 3...
</span></span></span><span class=line><span class=cl><span class=c1>// interval（重复间隔时间），是 timer 的语法糖
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>interval</span><span class=p>(</span><span class=mi>1000</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>));</span> <span class=c1>// 0 1 2 3...
</span></span></span><span class=line><span class=cl><span class=c1>// first 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>from</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>first</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>v</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// last 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>from</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>last</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>v</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span> <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// distinct 操作符（过滤之前出现过的数据，去重作用）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>from</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>distinct</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span> <span class=c1>// 1, 2, 3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// distinctUntilChanged 操作符（过滤“上次”出现过的数据）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>from</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>distinctUntilChanged</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span> <span class=c1>// 2, 1, 2, 1, 3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// combineLatest 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>cl1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cl2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 一秒钟后，cl2 接收到值之后，打印 [&#39;cl1&#39;, &#39;cl2&#39;]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>combineLatest</span><span class=p>([</span><span class=nx>cl1</span><span class=p>,</span> <span class=nx>cl2</span><span class=p>]).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>cl1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;cl1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>cl2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;cl2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// merge 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>m1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>m2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>m3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>merge</span><span class=p>(</span><span class=nx>m1</span><span class=p>,</span> <span class=nx>m2</span><span class=p>,</span> <span class=nx>m3</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span> <span class=c1>// m3, m1 一秒钟后 m2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>m3</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;m3&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>m2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;m2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>m1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;m1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// zip 操作符，强调值的数量相同
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>z1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>z2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>zip</span><span class=p>(</span><span class=nx>z1</span><span class=p>,</span> <span class=nx>z2</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>z1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>z1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>z2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> <span class=c1>// [1, 3]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第一个值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>z2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span> <span class=c1>// [2, 4]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第二个值
</span></span></span><span class=line><span class=cl><span class=c1>// concat 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>c1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>c2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>concat</span><span class=p>(</span><span class=nx>c1</span><span class=p>,</span> <span class=nx>c2</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>c1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>c2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>c1</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>c2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> <span class=c1>// 3，c1 被 complete 之前，c2 的值被忽略
</span></span></span><span class=line><span class=cl><span class=c1>// forkJoin 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fj1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fj2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>forkJoin</span><span class=p>(</span><span class=nx>fj1</span><span class=p>,</span> <span class=nx>fj2</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>fj1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fj2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fj1</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fj2</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span> <span class=c1>// [1, 2]
</span></span></span><span class=line><span class=cl><span class=c1>// race 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>r1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>r2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>race</span><span class=p>(</span><span class=nx>r1</span><span class=p>,</span> <span class=nx>r2</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>r2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>r1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 不打印，r1 没有竞争过 r2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>r2</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>r1</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span> <span class=c1>// 不打印
</span></span></span><span class=line><span class=cl><span class=c1>// catchError 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>new</span> <span class=nx>Observable</span><span class=p>(</span><span class=nx>sub</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>sub</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;normal&#39;</span><span class=p>);</span> <span class=c1>// 会走到 subscribe
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>sub</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>catchError</span><span class=p>(</span><span class=nx>error</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span> <span class=c1>// 只会打印 error
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=k>of</span><span class=p>(</span><span class=s1>&#39;catched&#39;</span><span class=p>);</span> <span class=c1>// 会走到 subscribe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span> <span class=c1>// 先打印 normal 再打印 catched
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// buffer 操作符，收集输出值（缓冲区）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>interval</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>buffer</span><span class=p>(</span><span class=nx>fromEvent</span><span class=p>(</span><span class=nb>document</span><span class=p>,</span> <span class=s1>&#39;click&#39;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * [0, 1, 2, 3]
</span></span></span><span class=line><span class=cl><span class=cm>     * [4, 5, 6, 7, 8, 9, 10]
</span></span></span><span class=line><span class=cl><span class=cm>     * ...
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// bufferCount 操作符，收集输出值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>interval</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>bufferCount</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span> <span class=c1>// 三个三个走
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * [0, 1, 2]
</span></span></span><span class=line><span class=cl><span class=cm>     * [3, 4, 5]
</span></span></span><span class=line><span class=cl><span class=cm>     * ...
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// bufferTime 操作符，收集输出值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>interval</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>bufferTime</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 等 3 秒 [0, 1]
</span></span></span><span class=line><span class=cl><span class=cm>     * 等 1 秒 [0, 1, 2, 3]
</span></span></span><span class=line><span class=cl><span class=cm>     * 等 1 秒 [2, 3, 4, 5]
</span></span></span><span class=line><span class=cl><span class=cm>     * ...
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// finalize 操作符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>f</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>f</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>finalize</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;finalize&#39;</span><span class=p>))).</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>f</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>);</span> <span class=c1>// next
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>f</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span> <span class=c1>// finalize
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>f</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span> <span class=c1>// finalize
</span></span></span></code></pre></td></tr></table></div></div><h3 id=observable>Observable</h3><p>不同于创建器（调用后返回 Observable 对象），Subject 是一个实现了 Observable 接口的“类”；需要先进行 new 调用，然后将数据“手动”放入“流”中（subject.next(value)）。</p><p>有别于普通的 Observable 对象（单播），new Subject 返回的是一个“多播”，可以被多次 subscribe，可以将值传递给多个观察者；所以常常被用来存放应用状态。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Subject</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subject</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>&lt;</span><span class=nt>unknown</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>((</span><span class=nx>res</span>: <span class=kt>unknown</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;one&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>((</span><span class=nx>res</span>: <span class=kt>unknown</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;two&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// 每个 subscribe 都收到新值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subject</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// one 1, two 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subject</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// one 2, two 2
</span></span></span><span class=line><span class=cl><span class=c1>// 通过 subject 将 observable 转换为“多播”
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>observable</span> <span class=o>=</span> <span class=kr>from</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>observable</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>subject</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// one 1, two: 1
</span></span></span><span class=line><span class=cl><span class=c1>// one 2, two: 2
</span></span></span><span class=line><span class=cl><span class=c1>// one 3, two: 3
</span></span></span></code></pre></td></tr></table></div></div><p>当 subscribe 被调用时，会返回一个“订阅凭证”；“订阅凭证”包含了一个 unsubscribe 方法，用来取消“订阅”（调用即可）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Observable</span><span class=p>,</span> <span class=nx>Subscription</span><span class=p>,</span> <span class=nx>interval</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>temp</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observable</span><span class=p>(</span><span class=nx>o</span> <span class=o>=&gt;</span> <span class=nx>o</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>performance</span><span class=p>.</span><span class=nx>now</span><span class=p>()));</span>
</span></span><span class=line><span class=cl><span class=c1>// 每次调用 subscribe 后生成了新的值，next 被调用了两次（数据产生于每次订阅后）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>temp</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>value</span><span class=p>));</span> <span class=c1>// 4491799.400000002
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>temp</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>value</span><span class=p>));</span> <span class=c1>// 4491799.699999999
</span></span></span><span class=line><span class=cl><span class=c1>// 执行顺序：2 -&gt; 0 -&gt; 3 -&gt; 1 -&gt; 4 -&gt; 0 -&gt; 5 -&gt; 1 -&gt; 6
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>park</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observable</span><span class=p>(</span><span class=nx>subscriber</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 每次调用 subscribe 后，这个函数会重新执行
</span></span></span><span class=line><span class=cl><span class=cm>   * 不会被放到微任务列表/下个事件循环
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscriber</span><span class=p>.</span><span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>park</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>park</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;5&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;6&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * subCollection.add
</span></span></span><span class=line><span class=cl><span class=cm> * subCollection.remove
</span></span></span><span class=line><span class=cl><span class=cm> * subCollection.unsubscribe
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subCollection</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscription</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>observable1</span> <span class=o>=</span> <span class=nx>interval</span><span class=p>(</span><span class=mi>400</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>observable2</span> <span class=o>=</span> <span class=nx>interval</span><span class=p>(</span><span class=mi>300</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subscription1</span> <span class=o>=</span> <span class=nx>observable1</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subscription2</span> <span class=o>=</span> <span class=nx>observable2</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>subCollection</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>subscription1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subCollection</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>subscription2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 可以存起来，一起被取消
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>subCollection</span><span class=p>.</span><span class=nx>unsubscribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=冷与热>“冷”与“热”</h3><p>“可观察对象”的分类：</p><ul><li>“冷”可观察对象，在 <strong>subscribe</strong> 之后，才将“值”添加到“流”中；有多少个订阅就会生成多少个订阅实例（单播，订阅接收到的值是相同的）；</li><li>“热”可观察对象，在<strong>创建</strong>之后，<strong>立即</strong>产生了“值”；多个订阅共享同一个实例（多播，订阅接收到的值取决于什么时间开始订阅的）。</li></ul><p>特殊的“可观察对象”：</p><ul><li>AsyncSubject，多播；需要初始值；只有当 complete 时，才会将“最后一个值”发送给订阅者；</li><li>BehaviorSubject，多播；需要初始值；保存了发送出去的“最后一个值”，“新的”订阅者会接收到这个值；</li><li>ReplaySubject，多播；需要初始值；保存了发送出去的“所有值”，“新的”订阅者会接收到所有“旧”值；</li><li>Subject，多播；不需要初始值；不会保存之前的任何值。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>AsyncSubject</span><span class=p>,</span> <span class=nx>EMPTY</span><span class=p>,</span> <span class=nx>Observable</span><span class=p>,</span> <span class=nx>Subject</span><span class=p>,</span> <span class=nx>throwError</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mySubject</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>&lt;</span><span class=nt>number</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=nx>mySubject</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>mySubject</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 因为 20 是 subscribe 才后放入流的
</span></span></span><span class=line><span class=cl><span class=cm>   * 而 10 是 subscribe 才前放入流的
</span></span></span><span class=line><span class=cl><span class=cm>   * 只会打印 20，没有接收到 10
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>mySubject</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>outter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cold</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observable</span><span class=p>(</span><span class=nx>sub</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>outter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>inner</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>sub</span><span class=p>.</span><span class=nx>next</span><span class=p>({</span> <span class=nx>inner</span><span class=p>,</span> <span class=nx>outter</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>cold</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>cold</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>v</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>hot</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AsyncSubject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>setInterval</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>hot</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * hot.complete 调用之后
</span></span></span><span class=line><span class=cl><span class=cm>   * hot.error 和 hot.next 的调用将被忽略
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>hot</span><span class=p>.</span><span class=nx>complete</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * hot.error 调用之后
</span></span></span><span class=line><span class=cl><span class=cm>   * subscribe 拿不到最后一个值
</span></span></span><span class=line><span class=cl><span class=cm>   * hot.complete 和 hot.next 的调用将被忽略
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>hot</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>hot</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>complete() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 只有 hot.complete 被调用
</span></span></span><span class=line><span class=cl><span class=cm>     * subscribe.next 才能拿到最后一个值
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>,</span> <span class=nx>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>EMPTY</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;只会触发 complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>throwError</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=s1>&#39;ERROR&#39;</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;只会触发 error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=xxxmap>xxxMap</h3><ol><li>switchMap：会自动帮我们处理“竞态”；在第一个请求没有完成的情况下，发起第二个请求；第一个请求将被忽略；</li><li>mergeMap：不会帮我们处理“竞态”；最终会使用哪个请求返回的结果，不一定；有可能新的请求使用旧的结果；</li><li>exhaustMap：第一个请求没处理完成，就会忽略新的请求；只有第一个求请完成的情况下，才能处理新的请求；</li><li>concatMap：开启队列，按<strong>顺序</strong>处理所有的请求及其副作用；不会丢弃老的/新的请求。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Subject</span><span class=p>,</span> <span class=nx>timer</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mapTo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>switchMap</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>mergeMap</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>concatMap</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>exhaustMap</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/operators&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sub</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>anyLongRunningOp</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>timer</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)).</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>mapTo</span><span class=p>(</span><span class=nx>value</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>triggerEvents</span><span class=p>(</span><span class=nx>operator</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>sub</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>asObservable</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>operator</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=nx>anyLongRunningOp</span><span class=p>(</span><span class=nx>value</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Got:&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nx>sub</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;First&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>sub</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=s1>&#39;Second&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * concatMap 会开启一个队列，保存每一个传入的值以及对应的操作
</span></span></span><span class=line><span class=cl><span class=cm> * 当第一个值 First 走完所有流程之后，才会开始处理 Second
</span></span></span><span class=line><span class=cl><span class=cm> * 所以结果是：
</span></span></span><span class=line><span class=cl><span class=cm> * 若干秒之后，打印 Got: First
</span></span></span><span class=line><span class=cl><span class=cm> * 又若干秒之后，打印 Got: Second
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>triggerEvents</span><span class=p>(</span><span class=nx>concatMap</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * exhaustMap 只关心传入的第一个值 First，并忽略后续传入的所有值
</span></span></span><span class=line><span class=cl><span class=cm> * 除非第一个值的流程已经走完，第二个值才传入
</span></span></span><span class=line><span class=cl><span class=cm> * 所以结果是：
</span></span></span><span class=line><span class=cl><span class=cm> * 若干秒之后，打印 Got: First，Second 这个值被丢弃
</span></span></span><span class=line><span class=cl><span class=cm> * 如果 Second 是在若干秒之后才传入的，此时 First 流程已经走完
</span></span></span><span class=line><span class=cl><span class=cm> * 那么，会打印 Got:Second
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>triggerEvents</span><span class=p>(</span><span class=nx>exhaustMap</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * mergeMap 不会等待上次流程的结束
</span></span></span><span class=line><span class=cl><span class=cm> * 他会同时处理传入的所有值
</span></span></span><span class=line><span class=cl><span class=cm> * 并且不保证顺序与传入顺序
</span></span></span><span class=line><span class=cl><span class=cm> * 所以结果是：
</span></span></span><span class=line><span class=cl><span class=cm> * 若干秒之后，同时打印出 Got:First、Got:Second
</span></span></span><span class=line><span class=cl><span class=cm> * 至于哪个在前，哪个在后，不确定
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>triggerEvents</span><span class=p>(</span><span class=nx>mergeMap</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 如果第二个值 Second 在两秒之内传给 switchMap
</span></span></span><span class=line><span class=cl><span class=cm> * switchMap 会丢弃对第一个值 First 的处理
</span></span></span><span class=line><span class=cl><span class=cm> * 所以结果是：
</span></span></span><span class=line><span class=cl><span class=cm> * 若干秒之后，只会打印 Got: Second
</span></span></span><span class=line><span class=cl><span class=cm> * First 这个值被丢弃
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>triggerEvents</span><span class=p>(</span><span class=nx>switchMap</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=filter-与-takewhile>filter 与 takeWhile</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=k>of</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>takeWhile</span><span class=p>,</span> <span class=nx>filter</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/operators&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>source</span> <span class=o>=</span> <span class=k>of</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>96</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// takeWhile 遇到不满足条件的数据，就 complete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>source</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>takeWhile</span><span class=p>(</span><span class=nx>it</span> <span class=o>=&gt;</span> <span class=nx>it</span> <span class=o>===</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>val</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;takeWhile&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>));</span> <span class=c1>// 3 3 3
</span></span></span><span class=line><span class=cl><span class=c1>// filter 遇到不满足条件的数据，过滤掉，没有 complete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>source</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>filter</span><span class=p>(</span><span class=nx>it</span> <span class=o>=&gt;</span> <span class=nx>it</span> <span class=o>===</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>val</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;filter&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>));</span> <span class=c1>// 3 3 3 3 3 3 3
</span></span></span></code></pre></td></tr></table></div></div><h3 id=first-与-take1>first 与 take(1)</h3><ol><li>当 first <strong>可以</strong>从数据流中取得一个值的时候，等同于 take(1)；</li><li>当 first <strong>不能</strong>从数据流中取得一个值的时候，会直接抛错误，而 take(1) 不会。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>EMPTY</span><span class=p>,</span> <span class=nx>range</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>first</span><span class=p>,</span> <span class=nx>take</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;rxjs/operators&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// first 遇上 EMPTY 打印 error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>EMPTY</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>first</span><span class=p>()).</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// 打印 next complete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>first</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// 不满足条件，打印 error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>first</span><span class=p>(</span><span class=nx>val</span> <span class=o>=&gt;</span> <span class=nx>val</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// take(1) 遇上 EMPTY 打印 complete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>EMPTY</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>take</span><span class=p>(</span><span class=mi>1</span><span class=p>)).</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// 打印 next complete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>take</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;complete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=aot-与-jit>AOT 与 JIT</h2><p>组件和模版需要经过编译，才能在浏览器中运行；Angular 提供了两种编译方式：</p><ul><li>Ahead-Of-Time 预编译（在打包/构建时编译，Angular 9 之后）：<ul><li>和别的模版一样，*.vue 和 *.jsx 也需要进行编译才能在浏览器中运行；</li><li>可以尽早地检测到代码中的错误，用户体验更有保障；</li><li>省去了在运行时编译的开销，应用响应更快；</li><li>减少了受 XSS 攻击的风险；</li><li>可以减小应用的体积。</li></ul></li><li>Just-In-Time 即时编译（在运行时编译，Angular 9 之前）：<ul><li>代码修改之后不需要重新编译，编译会在代码执行之前进行（按需编译）；</li><li>编译工作大多在浏览器内部进行，编译时间更短；</li><li>在项目中，较少被用到的组件更适合即时编译。</li></ul></li></ul><p>AOT 预编译分为三个阶段：</p><ol><li>代码分析：收集元数据并检验元数据中的错误：<ul><li>被收集的元数据存在于类装饰器/构造函数中；</li><li>AOT 收集器会根据 TS 编译器生成的 *.d.ts 输出 *.metadata.json；</li><li>*.metadata.json 包括了全部装饰器的元数据，结构就像 AST 一样；</li><li>AOT 编译器不支持“箭头函数”，所以不要在元数据中使用“() => {}”。</li></ul></li><li>代码生成：解释元数据（*.metadata.json），并对含有 useClass、useValue、useFactory 和 data 的对象字面量进行特殊处理（元数据重写）；</li><li>模版类型检查：TS 编译器会验证模版中绑定的表达式。</li></ol><p>JIT 编译器可以替代 AOT 编译器，在“运行时”将模板编译（需要将 compiler 打包）为浏览器中的可执行模板代码。</p><h2 id=安全>安全</h2><p>为了防范 XSS，Angular 认为所有值都是不可信任的；任何值在插入 DOM 之前，都会被进行“无害化”处理（前提是使用 Angular 模版，如果在代码中直接使用 DOM API，将没有“无害化”处理）。</p><p>Angular 定义了四个安全上下文：</p><ul><li>HTML：被解释为 HTML 的值，例如被绑定到 innerHTML 的值；</li><li>CSS：作为 CSS 被绑定到 style 属性的值；</li><li>网址：作为 URL 使用的值，例如被绑定到 a 标签 href 属性的值；</li><li>资源：作为代码需要被下载并运行的值，例如被绑定到 script 标签 src 属性的值。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;!-- {{ 插值中的内容总会被“无害化”}} --&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p class=&#34;e2e-inner-html-interpolated&#34;&gt;{{ htmlSnippet }}&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;!--
</span></span></span><span class=line><span class=cl><span class=sb>      绑定到 innerHTML 属性上的值，默认被认为是“不安全”的
</span></span></span><span class=line><span class=cl><span class=sb>      会被自动进行“无害化”
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;script&gt; 会被移除
</span></span></span><span class=line><span class=cl><span class=sb>    --&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p class=&#34;e2e-inner-html-bound&#34; [innerHTML]=&#34;htmlSnippet&#34;&gt;&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>InnerHtmlComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>htmlSnippet</span> <span class=o>=</span> <span class=s1>&#39;&lt;script&gt;alert(&#34;...&#34;)&lt;/script&gt;&lt;b&gt;Syntax&lt;/b&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果某个值被确认是可信的，可以通过 <a class=link href=https://angular.cn/api/platform-browser/DomSanitizer target=_blank rel=noopener>DomSanitizer
</a>将这个值标记为安全值，安全的值将不会被进行“无害化”。</p><p>DomSanitizer 提供了六种方法：</p><ul><li>sanitize(context, value)：根据给定的安全上下文 context，对 value 进行“无害化”；</li><li>bypassSecurityTrustHtml(value)：信任给定的值 value 是一个安全的 HTML；</li><li>bypassSecurityTrustStyle(value)：信任给定的值 value 是一个安全的样式；</li><li>bypassSecurityTrustScript(value)：信任给定的值 value 是一个安全的 JS；</li><li>bypassSecurityTrustUrl(value)：信任给定的值 value 是一个安全的 URL；</li><li>bypassSecurityTrustResourceUrl(value)：信任给定的值 value 是一个安全的资源。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;h4&gt;自动无害化处理&lt;/h4&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;&lt;a [href]=&#34;dangerousUrl&#34;&gt;Click Me&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;h4&gt;不会进行无害化处理&lt;/h4&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;&lt;a [href]=&#34;trustedUrl&#34;&gt;Click Me&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>BypassSecurityTrustComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>sanitizer</span>: <span class=kt>DomSanitizer</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>dangerousUrl</span> <span class=o>=</span> <span class=s1>&#39;javascript:alert(&#34;Hello&#34;)&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>trustUrl</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sanitizer</span><span class=p>.</span><span class=nx>bypassSecurityTrustUrl</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>dangerousUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=参考>参考</h2><ul><li><a class=link href=https://dev.to/christiankohler/improved-dependeny-injection-with-the-new-providedin-scopes-any-and-platform-30bb target=_blank rel=noopener>Improved Dependency Injection With The New ProvidedIn Scopes &lsquo;any&rsquo; And &lsquo;platform&rsquo;</a></li><li><a class=link href=https://medium.com/@rk-tech/simplified-explanation-of-switchmap-concatmap-mergemap-and-exhaustmap-bceb98081714 target=_blank rel=noopener>Simplified Explanation of switchMap, concatMap, mergeMap, and exhaustMap</a></li><li><a class=link href=https://juejin.cn/post/7012492445506093092 target=_blank rel=noopener>深入理解 Angular 依赖注入（二）：依赖注入在 Angular 中的应用</a></li><li><a class=link href=https://limeii.github.io/2019/06/angular-changeDetectionStrategy-OnPush/ target=_blank rel=noopener>Angular Change Detection：变更检测策略</a></li><li><a class=link href=https://www.geeksforgeeks.org/what-is-aot-and-jit-compiler-in-angular/ target=_blank rel=noopener>What Is AOT And JIT Compiler In Angular?</a></li><li><a class=link href=https://juejin.cn/post/6869995328330792968 target=_blank rel=noopener>ng-template、ng-content、ng-container</a></li><li><a class=link href=https://www.cnblogs.com/laixiangran/p/8723166.html target=_blank rel=noopener>使用 ng-content 进行组件内容投射</a></li><li><a class=link href=https://blog.kevinyang.net/2018/01/19/angular-viewproviders-providers/ target=_blank rel=noopener>viewProviders vs providers</a></li><li><a class=link href=https://blog.thoughtram.io/angular/2016/06/16/cold-vs-hot-observables.html target=_blank rel=noopener>Cold vs Hot Observables</a></li><li><a class=link href=https://blog.ralph.wang/articles/23a34d9e_RxJS_%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8 target=_blank rel=noopener>RxJS 快速入门</a></li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/angular-%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/><div class=article-image><img src=/img/cover/angular.png loading=lazy data-key data-hash=/img/cover/angular.png></div><div class=article-details><h2 class=article-title>Angular 组件设计</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2017 -
2024
<a href=https://github.com/Vikingama target=_blank>馬腊咯稽</a></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>, Deploy by Actions<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.13.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#组件>组件</a></li><li><a href=#指令没有模版的特殊组件>指令（没有“模版”的特殊组件）</a></li><li><a href=#管道>管道</a></li><li><a href=#服务>服务</a></li><li><a href=#模块>模块</a></li><li><a href=#表单>表单</a></li><li><a href=#路由>路由</a></li><li><a href=#依赖注入>依赖注入</a></li><li><a href=#双向绑定>双向绑定</a></li><li><a href=#绑定语法>绑定语法</a></li><li><a href=#模版变量>模版变量</a></li><li><a href=#网络请求>网络请求</a></li><li><a href=#特殊标签>特殊标签</a></li><li><a href=#特殊选择器>特殊选择器</a></li><li><a href=#contentchild-与-viewchild>ContentChild 与 ViewChild</a></li><li><a href=#changedetectorref>ChangeDetectorRef</a></li><li><a href=#rxreactivexjs>Rx(ReactiveX)JS</a><ol><li><a href=#操作符>操作符</a></li><li><a href=#observable>Observable</a></li><li><a href=#冷与热>“冷”与“热”</a></li><li><a href=#xxxmap>xxxMap</a></li><li><a href=#filter-与-takewhile>filter 与 takeWhile</a></li><li><a href=#first-与-take1>first 与 take(1)</a></li></ol></li><li><a href=#aot-与-jit>AOT 与 JIT</a></li><li><a href=#安全>安全</a></li><li><a href=#参考>参考</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script></body></html>